(function(e){parser=new DOMParser,watch_id={},e.updateMap=({coords1:e,address1:t,coords2:r,address2:l,center:n,mapDivID:i})=>!1,"undefined"!=typeof Swipe&&(e.Swipe=new Swipe(document.querySelector("#slider"),{startSlide:0,speed:300,draggable:!1,continuous:!0,autoRestart:!1,disablescroll:!1,stopPropagation:!1,callback:function(){},transitionEnd:function(t,r){let l=["Route","On Call","Dispatch","Transfers","Ticket Entry","Delivery Request"];document.querySelector(".menu__list__active").classList.remove("menu__list__active"),Array.from(document.querySelectorAll(".page")).forEach(e=>{if(e.id===r.id?e.classList.add("active"):e.classList.remove("active"),e.id===r.id){let t=document.querySelector("a.nav[data-id='"+e.id+"']").innerHTML.split("<");if(-1!==l.indexOf(t[0])){let e=make(["button",{type:"button"},t[0]]),r="refresh"+t[0].replace(/\s/g,"");if(e.addEventListener("click",window.rjdci[r]),clearElement(document.querySelector(".pageTitle")),document.querySelector(".pageTitle").appendChild(e),1<t.length){let e="<"+t[1]+"<"+t[2],r=parser.parseFromString(e,"text/html"),l=r.querySelector("span");l&&document.querySelector(".pageTitle").appendChild(l)}}else{let t=make(["span"]);Array.from(document.querySelector("a.nav[data-id='"+e.id+"']").childNodes).forEach(e=>{t.appendChild(e.cloneNode(!0))}),clearElement(document.querySelector(".pageTitle")),document.querySelector(".pageTitle").appendChild(t)}document.querySelector("a.nav[data-id='"+e.id+"']").parentNode.classList.add("menu__list__active")}}),scroll(0,0),document.dispatchEvent(e.pageChange)}})),e.loggedout=new Event("rjdci_loggedout"),e.loggedin=new Event("rjdci_loggedin"),e.resolutionchange=new Event("rjdci_resolutionchange"),e.loaded=new Event("rjdci_loaded"),e.pageChange=new Event("rjdci_pageChange"),e.refreshedRoute=new CustomEvent("rjdci_refreshed",{bubbles:!0,detail:{type:()=>"route"}}),e.refreshedOnCall=new CustomEvent("rjdci_refreshed",{bubbles:!0,detail:{type:()=>"oncall"}}),e.refreshedTransfers=new CustomEvent("rjdci_refreshed",{bubbles:!0,detail:{type:()=>"transfers"}}),e.refreshedDispatch=new CustomEvent("rjdci_refreshed",{bubbles:!0,detail:{type:()=>"dispatch"}}),e.refreshedTicketEntry=new CustomEvent("rjdci_refreshed",{bubbles:!0,detail:{type:()=>"ticketEntry"}}),e.triggerEvent=(e,t)=>{if(document.createEvent){let r=document.createEvent("HTMLEvents");return r.initEvent(t,!0,!0),e.dispatchEvent(r)}return e.fireEvent?e.fireEvent("on"+t):void 0},psudorand=e=>{let t="",r=e||5;for(;t.length<r;)t+=Math.random().toString(36).slice(2);return t.slice(0,r+1)},ucfirst=e=>e.charAt(0).toUpperCase()+e.slice(1),lcfirst=e=>e.charAt(0).toLowerCase()+e.slice(1),Array.isArray||(Array.isArray=e=>"[object Array]"===Object.prototype.toString.call(e)),make=e=>{let t=e[0],r=e[1],l=document.createElement(t),n=1;if(r&&"object"==typeof r&&!Array.isArray(r)){for(let e in r)l.setAttribute(e,r[e]);n=2}for(let t=n;t<e.length;t++)Array.isArray(e[t])?l.appendChild(make(e[t])):l.appendChild(document.createTextNode(e[t]));return l},e.getSpinner=()=>make(["div",{class:"loader"},["div",{class:"face"},["div",{class:"circle"}]],["div",{class:"face"},["div",{class:"circle"}]]]),displayErrorMessage=e=>make(["p",{class:"ceneter"},["span",{class:"error"},"Error"],`: ${e.message}`]),clearElement=e=>{for(;e.firstChild;)e.removeChild(e.firstChild)},e.refreshFormKey=async()=>await e.fetch_template({url:"./refreshFormKey.php",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(e=>e&&e.ok?e.text():"error").then(e=>document.querySelector("#formKey").value=e),e.logout=async t=>{let r=t||0,l=document.querySelector("#uid").value;if(!l.match(/(driver|dispatch)\d+/))return document.querySelector("#logoutLink").submit();let n={logout:1,formKey:document.querySelector("#formKey").value};await e.fetch_template({url:"./logout",postData:n,headers:{"Content-Type":"application/x-www-form-urlencoded","Content-Length":JSON.stringify(n).length}}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(`${e.status} ${e.statusText}`)}).then(t=>-1===t.indexOf("error")?void document.querySelector("#logoutLink").submit():(r++,e.logout(r))).then(e.refreshFormKey).catch(()=>(r++,5<r?document.querySelector("#logoutLink").submit():e.logout(r)))},e.toast=(t,r)=>{let l;if(!t)return;Array.isArray(t)||(t=[t]),r=r||{},r.title=r.title||"",r.time=r.time||4e3,r.class=r.class||["toast__msg"],r.datatime=r.datatime||new Date().getTime();let n=document.querySelector(".toast__container");toastMsg=document.createElement("div"),d=new Date(+r.datatime),mins=d.getMinutes(),tmpClass="string"==typeof r.class||r.class instanceof String?r.class.split(" "):r.class,toastMsg.classList.add(...tmpClass),toastMsg.title=r.title,l=10>mins?`0${mins.toString()}`:mins.toString(),t.push(...[`${["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][d.getDay()]} ${["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][d.getMonth()]} ${d.getDate()}`,`${d.getHours()}:${l}`]);for(let e=0;e<t.length;e++)toastMsg.appendChild(make(["p",t[e]]));if(toastMsg.setAttribute("data-time",r.datatime),!toastMsg.classList.contains("toast__msg")){toastMsg.addEventListener("click",t=>"DIV"===t.target.tagName.toUpperCase()?t.target.remove():e.triggerEvent(e.getClosest(t.target,"div"),"click"));for(let e,t=0;t<n.children.length;t++)e=!1,n.children[t].classList.forEach(r=>{!e&&toastMsg.classList.contains(r)&&(n.children[t].remove(),e=!0)})}n.appendChild(toastMsg),setTimeout(()=>{toastMsg.classList.contains("toast__msg")&&toastMsg.remove()},r.time)},e.getClosest=function(e,t){for(Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(e){for(var t=(this.document||this.ownerDocument).querySelectorAll(e),r=t.length;0<=--r&&t.item(r)!==this;);return-1<r});e&&e!==document;e=e.parentNode)if(e.matches(t))return e;return null},e.pause=e=>new Promise(t=>setTimeout(t,e)),e.fetch_template=async({url:t,method:r="POST",headers:l={},postData:n={},retry:i=0})=>{if(!t)throw new Error("URL not defined");let a={method:r.toUpperCase(),headers:l};if(n instanceof FormData||0<Object.keys(n).length){let e;n instanceof FormData?(e=n,a.headers["Content-Type"]&&delete a.headers["Content-Type"],a.headers["Content-Length"]&&delete a.headers["Content-Length"]):a.headers.hasOwnProperty("Content-Type")&&-1!=a.headers["Content-Type"].indexOf("x-www-form-urlencoded")?e=Object.entries(n).map(([e,t])=>`${encodeURIComponent(e)}=${encodeURIComponent(t)}`).join("&"):(e=JSON.stringify(n),!l.hasOwnProperty("Content-Type")&&(a.headers["Content-Type"]="application/json")),a.method="POST",a.body=e}try{return await fetch(t,a)}catch(a){if(i++,20===i)throw a;return await e.pause(250*i),await e.fetch_template({url:t,method:r,headers:l,postData:n,retry:i})}},e.showLogin=()=>{let t=document.getElementById("confirmLogin");0<t.offsetWidth&&0<t.offsetHeight||t.classList.remove("hide"),e.centerForm(t),document.dispatchEvent(e.loggedout)},e.enableApp=()=>{document.querySelector("header").classList.remove("loggedout"),document.querySelector(".menu__header").classList.remove("loggedoutHeader"),Array.from(document.querySelectorAll("button")).forEach(e=>{e.disabled=!1})},e.disableApp=()=>{let e=document.querySelector("header"),t=document.querySelector(".menu__header");return!(void 0===e||void 0===t||e.classList.contains("loggedout"))&&void(e.classList.add("loggedout"),t.classList.add("loggedoutHeader"),Array.from(document.querySelectorAll("button")).forEach(e=>{"confirm"!==e.id&&"cancel"!==e.id&&(e.disabled=!0)}))},e.isTarget=e=>{let t=["billTo","dispatchedTo","dispatchedByUser","shippingCountry","billingCountry","pCountry","dCountry","members"];for(let r=0;r<t.length;r++)if(e.classList.contains(t[r]))return!0;return!1},e.disableButtonsTickets=()=>{let e=0,t=document.querySelectorAll("#ticket_query .orgMember"),r=document.querySelector("#compareMembersTickets");for(let r=0;r<t.length;r++)!0===t[r].checked&&e++;r.disabled=!(1<e&&"chart"===document.querySelector("#display").value),!0===r.disabled&&(r.checked=!1)},e.disable_scroll=()=>{window.ontouchmove=t=>t.preventDefault()},e.enable_scroll=()=>{window.ontouchmove=()=>!0},e.fixDeadRunButton=()=>{let e=document.querySelector(".cancelRun:not(.hide)");if(!e)return;let t=e.offsetHeight;Array.from(document.querySelectorAll(".deadRun")).forEach(e=>{e.innerText="Dead Run",e.offsetHeight>t&&(e.innerText="D. Run")})},e.centerForm=e=>{let t=document.body.getBoundingClientRect(),r=t.width,l=e.getBoundingClientRect(),n=l.width;e.style.left=(r-n)/2+"px"},isStopBeforeNoon=e=>{timestamp=1e3*+e.querySelector(".timing").innerText;let t=new Date(timestamp);return 12>t.getHours()},isStopAfterNoon=e=>{timestamp=1e3*+e.querySelector(".timing").innerText;let t=new Date(timestamp);return 12<=t.getHours()},sortRoute=()=>{let e,t=document.querySelector("#route"),r=document.getElementById("overnightFlag")?document.getElementById("overnightFlag").innerText:0,l=Array.from(t.querySelectorAll(".sortable")).filter(isStopBeforeNoon),n=Array.from(t.querySelectorAll(".sortable")).filter(isStopAfterNoon);l.sort((e,t)=>e.querySelector(".timing").textContent>t.querySelector(".timing").textContent?1:-1),n.sort((e,t)=>e.querySelector(".timing").textContent>t.querySelector(".timing").textContent?1:-1),e="1"===r?[...n,...l]:[...l,...n];let i=document.createDocumentFragment();e.forEach(e=>{i.appendChild(e)}),t.appendChild(i)},e.refreshRoute=async()=>{let t=e.getSpinner(),r={formKey:document.querySelector("#formKey").value};clearElement(document.querySelector("#route")),document.querySelector("#route").appendChild(t),scrollTo(0,0),await e.fetch_template({url:"./refreshRoute.php",postData:r,headers:{"Content-Type":"application/x-www-form-urlencoded","Content-Length":JSON.stringify(r).length}}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(`${e.status} ${e.statusText}`)}).then(r=>{if(-1!==r.indexOf("Session Error"))return document.querySelector("#function").value="refreshRoute",e.showLogin();if(-1!==r.indexOf("error"))throw new Error(r);let l=parser.parseFromString(r,"text/html"),n=document.createDocumentFragment();Array.from(l.querySelectorAll(".sortable, .result, #overnightFlag")).forEach(e=>{n.appendChild(e)}),setTimeout(()=>{document.querySelector("#route").removeChild(t),document.querySelector("#route").appendChild(n),e.assignRouteListeners(),e.fixDeadRunButton(),sortRoute(),document.dispatchEvent(e.refreshedRoute)},2e3)}).then(e.refreshFormKey).catch(e=>{console.error(e.message),t.parentNode.removeChild(t),document.querySelector("#route").appendChild(displayErrorMessage(e))})},countOnCallTickets=e=>{let t=Array.from(document.querySelectorAll("#on_call .tickets")).length;t>e&&(document.querySelector(".alert").classList.add("onCallAlert"),document.querySelector(".alert").innerHTML="!",document.querySelector("#newUpdate").classList.remove("hide")),0===t&&document.querySelector(".alert").classList.remove("onCallAlert");let r=document.querySelector(".alert").getAttribute("class").split(/\s+/);1===r.length&&clearElement(document.querySelector(".alert")),Array.from(document.querySelectorAll(".ticketCount")).forEach(e=>{e.innerHTML=t})},sortOnCall=()=>{let e=document.querySelector("#on_call"),t=Array.from(e.querySelectorAll(".sortable")),r=document.createDocumentFragment();t.sort((e,t)=>e.querySelector(".timing").textContent>t.querySelector(".timing").textContent?1:-1),t.forEach(e=>{r.appendChild(e)}),e.appendChild(r)},e.refreshOnCall=async()=>{let t=document.querySelector(".ticketCount").innerHTML,r=e.getSpinner(),l={formKey:document.querySelector("#formKey").value};clearElement(document.querySelector("#on_call")),document.querySelector("#on_call").appendChild(r),scrollTo(0,0),await e.fetch_template({url:"./refreshOnCall.php",postData:l,headers:{"Content-Type":"application/x-www-form-urlencoded","Content-Length":JSON.stringify(l).length}}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(`${e.status} ${e.statusText}`)}).then(l=>{if(-1!==l.indexOf("Session Error"))return document.querySelector("#function").value="refreshOnCall",e.showLogin();if(-1!==l.indexOf("error"))throw new Error(l);let n=parser.parseFromString(l,"text/html"),i=document.createDocumentFragment();Array.from(n.querySelectorAll(".sortable, .result")).forEach(e=>{i.appendChild(e)}),setTimeout(()=>{document.querySelector("#on_call").removeChild(r),document.querySelector("#on_call").appendChild(i),e.assignOnCallListeners(),e.fixDeadRunButton(),sortOnCall(),countOnCallTickets(t),document.dispatchEvent(e.refreshedOnCall)},2e3)}).then(e.refreshFormKey).catch(e=>{console.error(e.message),r.parentNode.removeChild(r),document.querySelector("#on_call").appendChild(displayErrorMessage(e))})},countInitOnCall=()=>{let e=Array.from(document.querySelectorAll("#on_call .tickets")).length;Array.from(document.querySelectorAll(".ticketCount")).forEach(t=>{t.innerHTML=e}),0<e&&(document.querySelector(".alert").classList.add("onCallAlert"),document.querySelector(".alert").innerHTML="!")},e.refreshDeliveryRequest=e.refreshTicketEntry=async()=>{let t=document.querySelector("#deliveryRequest"),r=t.parentNode;target=r.querySelector(".subContainer"),localSpinner=e.getSpinner(),postData={edit:1,formKey:document.querySelector("#formKey").value},target.remove(),t.remove(),r.appendChild(localSpinner),scrollTo(0,0),await e.fetch_template({url:"./refreshTicketForm.php",postData:postData,headers:{"Content-Type":"application/x-www-form-urlencoded","Content-Length":JSON.stringify(postData).length}}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(`${e.status} ${e.statusText}`)}).then(t=>{if(-1!==t.indexOf("Session Error"))return document.querySelector("#function").value="refreshDeliveryRequest",e.showLogin();if(-1!==t.indexOf("error"))throw new Error(t);let l=parser.parseFromString(t,"text/html"),n=document.createDocumentFragment();l.querySelector("#deliveryRequest")&&n.appendChild(l.querySelector("#deliveryRequest")),setTimeout(()=>{localSpinner.remove(),r.appendChild(n),r.appendChild(target),e.updateMap({mapDivID:"map"}),assignTicketFormListeners(),document.dispatchEvent(e.refreshedTicketEntry)},2e3)}).then(e.refreshFormKey).catch(e=>{console.error(e),localSpinner.remove();let l=displayErrorMessage(e);r.append(l,t,target),setTimeout(()=>{l.remove()},3500)})},e.countDispatch=e=>{let t=document.querySelector("#dispatch .tickets")?Array.from(document.querySelectorAll("#dispatch .tickets")).length:0,r=document.querySelector(".alert");t>e&&(r.classList.add("dispatchAlert"),r.innerHTML="!"),0===t&&r.classList.remove("dispatchAlert"),1===r.classList.length&&(r.innerHTML=""),Array.from(document.querySelectorAll(".dispatchCount")).forEach(e=>{e.innerHTML=t})},e.refreshDispatch=async()=>{let t=+document.querySelector(".dispatchCount").innerHTML-1,r=e.getSpinner(),l={formKey:document.querySelector("#formKey").value};clearElement(document.querySelector("#dispatch")),document.querySelector("#dispatch").appendChild(r),scrollTo(0,0),await e.fetch_template({url:"../drivers/refreshDispatch.php",postData:l,headers:{"Content-Type":"application/x-www-form-urlencoded","Content-Length":JSON.stringify(l).length}}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(`${e.status} ${e.statusText}`)}).then(l=>{if(-1!==l.indexOf("Session Error"))return document.querySelector("#function").value="refreshDispatch",e.showLogin();if(-1!==l.indexOf("error"))throw new Error(l);let n=parser.parseFromString(l,"text/html"),i=document.createDocumentFragment();Array.from(n.querySelectorAll(".sortable, .result")).forEach(e=>{i.appendChild(e)}),setTimeout(()=>{document.querySelector("#dispatch").removeChild(r),document.querySelector("#dispatch").appendChild(i),e.assignDispatchListeners(),e.countDispatch(t),Array.from(document.querySelectorAll("#dispatch .dTicket")).forEach(t=>{t.removeEventListener("click",e.stepTicket),t.addEventListener("click",e.stepTicket)}),document.dispatchEvent(e.refreshedDispatch)},2e3)}).then(e.refreshFormKey).catch(e=>{console.error(e.message),r.parentNode.removeChild(r),document.querySelector("#dispatch").appendChild(displayErrorMessage(e))})},countInitDispatch=()=>{let e=Array.from(document.querySelectorAll("#dispatch .tickets")).length;Array.from(document.querySelectorAll(".dispatchCount")).forEach(t=>{t.innerHTML=e}),0<e&&(document.querySelector(".alert").classList.add("dispatchAlert"),document.querySelector(".alert").innerHTML="!")},countTransferTickets=e=>{let t=Array.from(document.querySelectorAll("#transfers .sortable")).length,r=document.querySelector(".alert");t>e&&(r.classList.add("transfersAlert"),r.innerHTML="!",document.querySelector("#newUpdate").classList.remove("hide")),0===t&&r.classList.remove("transfersAlert"),1===r.classList.length&&(r.innerHTML=""),Array.from(document.querySelectorAll(".transfersCount")).forEach(e=>{e.innerHTML=t})},e.refreshTransfers=async()=>{let t=document.querySelector(".transfersCount").innerHTML,r=e.getSpinner(),l={formKey:document.querySelector("#formKey").value};clearElement(document.querySelector("#transfers")),document.querySelector("#transfers").appendChild(r),scrollTo(0,0),await e.fetch_template({url:"./refreshTransfers.php",postData:l,headers:{"Content-Type":"application/x-www-form-urlencoded","Content-Length":JSON.stringify(l).length}}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(`${e.status} ${e.statusText}`)}).then(l=>{if(-1!==l.indexOf("Session Error"))return document.querySelector("#function").value="refreshTransfers",e.showLogin();if(-1!==l.indexOf("error"))throw new Error(l);let n=parser.parseFromString(l,"text/html"),i=document.createDocumentFragment();Array.from(n.querySelectorAll(".sortable, .result")).forEach(e=>{i.appendChild(e)}),setTimeout(()=>{r.remove(),document.querySelector("#transfers").appendChild(i),e.assignTransferListeners(),countTransferTickets(t),document.dispatchEvent(e.refreshedTransfers)},2e3)}).then(e.refreshFormKey).catch(e=>{console.error(e.message),r.parentNode.removeChild(r),document.querySelector("#transfers").appendChild(displayErrorMessage(e))})},countInitTransfers=()=>{let e=Array.from(document.querySelectorAll("#transfers .sortable")).length;Array.from(document.querySelectorAll(".transfersCount")).forEach(t=>{t.innerHTML=e}),0<e&&(document.querySelector(".alert").classList.add("transfersAlert"),document.querySelector(".alert").innerHTML="!")},e.assignLinkValues=()=>{let e=document.getElementsByClassName("nav"),t=["Route","On Call","Dispatch","Transfers","Ticket Entry","Delivery Request"];for(let r=0;r<e.length;r++)if(e[r].setAttribute("data-value",r),0==r){let l=e[r].innerHTML.split("<");if(-1!==t.indexOf(l[0])){let e=make(["button",{type:"button"},l[0]]),t="refresh"+l[0].replace(/\s/g,"");if(e.addEventListener("click",window.rjdci[t]),clearElement(document.querySelector(".pageTitle")),document.querySelector(".pageTitle").appendChild(e),1<l.length){let e="<"+l[1]+"<"+l[2],t=parser.parseFromString(e,"text/html"),r=t.querySelector("span");r&&document.querySelector(".pageTitle").appendChild(r)}}else document.querySelector(".pageTitle").innerHTML=e[r].innerHTML}},e.populatePage=async()=>{let t,r=[".sortable","#ticketEditor","#ticketEditorResultContainer","datalist","#javascriptVars","#deliveryRequest",".subContainer",".PWcontainer","#ticketQueryOptions","#ticketQueryResults","#invoiceQueryOptions","#invoiceQueryResults","#priceContainer","#clientUpdateForm",".result"],l=document.createDocumentFragment(),n=new FormData;n.append("formKey",document.querySelector("#formKey").value),Array.from(document.querySelectorAll(".page")).forEach(e=>{e.getAttribute("data-function")!==void 0&&""!==e.getAttribute("data-function")&&n.append("functions[]",e.getAttribute("data-function"))}),await e.fetch_template({url:"./initApp.php",postData:n}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(`${e.status} ${e.statusText}`)}).then(n=>{if(-1!==n.indexOf("Session Error"))return document.getElementById("function").value="populatePage",e.showLogin();let a;try{a=JSON.parse(n)}catch(e){throw console.log(n),e.message=e.message+"\n"+n,e}for(let e=0;e<a.length;e++)document.querySelectorAll(".page").forEach(n=>{if(+n.getAttribute("data-index")===e){clearElement(n),t=parser.parseFromString(a[e],"text/html"),nodeList=t.querySelectorAll(r.toString());for(node of nodeList)l.appendChild(node);n.appendChild(l),clearElement(l)}});scrollTo(0,0),null!==document.getElementById("route")&&sortRoute(),null!==document.getElementById("on_call")&&(sortOnCall(),countInitOnCall()),null!==document.getElementsByClassName("deadRun")&&e.fixDeadRunButton(),null!==document.getElementById("dispatch")&&countInitDispatch(),null!==document.getElementById("transfers")&&countInitTransfers()}).then(e.refreshFormKey).catch(e=>{Array.from(document.querySelectorAll(".page")).forEach(t=>{t.innerHTML="",t.appendChild(displayErrorMessage(e))})})},e.deliveryLocation=({ticket_index:t=[],step:r=[],id:l=""})=>{if("undefined"==typeof navigator.permissions||"undefined"==typeof navigator.geolocation)return e.toast("Location Not Available");let n=0,i=0,a=5,o=!1,s={};s.title="Updating Location",s.class=`dl${l}`,e.toast(["Updating Location","Do not","disable screen"],s),navigator.permissions.query({name:"geolocation"}).then(c=>{let u={enableHighAccuracy:!0,timeout:25e3,maximumAge:0},p=e=>{if(n++,console.log("success_count",n),o=1<n?o&&o.coords.accuracy<e.coords.accuracy?o:e:e,n>a||2<n&&o.coords.accuracy<10)return navigator.geolocation.clearWatch(watch_id[l]),delete watch_id[l],y(o)},h=t=>{if(i++,e.toast(["Location Not Available",t.message,"Tap to dismiss"],s),n>a||i>a)return navigator.geolocation.clearWatch(watch_id[l]),delete watch_id[l],y(o)},y=async l=>{if(!l)return e.toast(["Location Not Available","Tap to dismiss"],s);if(t.length!==r.length||0===t.length)return e.toast(["Location Data Error","Tap to dismiss"],s);let n={},i={};if(n.formKey=document.querySelector("#formKey").value,1<t.length){let e=[];t.forEach((t,n)=>{i.ticket_index=t,i[r[n]+"Lat"]=l.coords.latitude,i[r[n]+"Lng"]=l.coords.longitude,e[n]=i,i={}}),n.multiTicket=JSON.stringify(e)}else n.ticket_index=t[0],n[r[0]+"Lat"]=l.coords.latitude,n[r[0]+"Lng"]=l.coords.longitude;await e.fetch_template({url:"./updateTicket.php",postData:n,headers:{"Content-Type":"application/x-www-form-urlencoded","Content-Length":JSON.stringify(n).length}}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(`${e.status} ${e.statusText}`)}).then(t=>{if(-1!==t.indexOf("Session Error"))return e.showLogin();if(-1!==t.indexOf("error"))throw new Error(t);return e.toast(["Location Updated","Tap to dismiss"],s)}).then(e.refreshFormKey).catch(t=>(console.error(t),e.toast([t.message,"Tap to dismiss"],s)))};if("granted"==c.state)watch_id[l]=navigator.geolocation.watchPosition(p,h,u);else if("prompt"==c.state)navigator.geolocation.getCurrentPosition(()=>{});else if("denied"==c.state)return!1;c.onchange=()=>{if("granted"===c.state)watch_id[l]=navigator.geolocation.watchPosition(p,h,u);else{if("prompt"==c.state)return!1;if("denied"==c.state)return!1}}})},getCancelThis=()=>{let t=make(["button",{type:"button",class:"cancelThis"},"Go Back"]);return t.addEventListener("click",e.cancelThis),t},e.cancelThis=t=>{let r=e.getClosest(t.target,".sortable");Array.from(r.querySelectorAll("button")).forEach(e=>{e.disabled=!1}),t.target.parentNode.innerHTML=""},getStepTicket=t=>{let r=make(["button",{type:"button",class:"stepTicket",form:t},"Confirm"]);return r.addEventListener("click",e.stepTicket),r},e.stepTicket=async t=>{t.preventDefault(),t.target.setAttribute("disabled",!0);let r,l={},n=!1,i=!t.target.parentElement.classList.contains("message2"),a=e.getClosest(t.target,".message2")||e.getClosest(t.target,"form").querySelector(".message2"),o=e.getClosest(t.target,".page").getAttribute("id"),s=make(["span",{class:"ellipsis"},"."]);if(Array.from(document.querySelectorAll("input[form="+t.target.getAttribute("form")+"], textarea[form="+t.target.getAttribute("form")+"]")).forEach(e=>{"latitude"!==e.getAttribute("name")&&"longitude"!==e.getAttribute("name")&&(!0===e.required&&""===e.value&&(n=!0,e.classList.add("elementError"),setTimeout(()=>{e.classList.remove("elementError")},3e3)),l[e.getAttribute("name")]="checkbox"===e.getAttribute("type")?+e.checked:e.value)}),l.formKey=document.querySelector("#formKey").value,n)return void(i&&t.target.removeAttribute("disabled"));a.innerHTML="",a.appendChild(s);let c=!0,u=setInterval(()=>{!0===c&&(s.innerHTML+="..",c=15>s.innerHTML.length&&1!=s.innerHTML.length),!1===c&&(s.innerHTML=s.innerHTML.slice(2),c=1===s.innerHTML.length)},500);switch(l.hasOwnProperty("pSigPrint")&&(l.printName=l.pSigPrint,delete l.pSigPrint),l.hasOwnProperty("dSigPrint")&&(l.printName=l.dSigPrint,delete l.dSigPrint),l.hasOwnProperty("d2SigPrint")&&(l.printName=l.d2SigPrint,delete l.d2SigPrint),document.querySelector(".step[form=\""+t.target.getAttribute("form")+"\"]").value){case"pickedUp":r="p";break;case"delivered":r="d";break;case"returned":r="d2";}let p;for(;!p||watch_id.hasOwnProperty(p);)p=psudorand();r&&e.deliveryLocation({ticket_index:[l.ticket_index],step:[r],id:p}),await e.fetch_template({url:"../drivers/updateStep.php",postData:l,headers:{"Content-Type":"application/x-www-form-urlencoded","Content-Length":JSON.stringify(l).length}}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(`${e.status} ${e.statusText}`)}).then(t=>{if(clearInterval(u),a.removeChild(s),-1!==t.indexOf("Session Error"))return watch_id[p]&&(navigator.geolocation.clearWatch(watch_id[p]),document.querySelector(`.dl${p}`)&&document.querySelector(`.dl${p}`).remove(),delete watch_id[p]),e.showLogin();if(-1===t.indexOf("error")){let r=parser.parseFromString(t,"text/html"),l=document.createDocumentFragment();Array.from(r.querySelectorAll(".result")).forEach(e=>{l.appendChild(e)}),a.appendChild(l),setTimeout(()=>{"route"===o?e.refreshRoute():"on_call"===o?e.refreshOnCall():"dispatch"===o?e.refreshDispatch():void 0},3e3)}else throw new Error(t)}).then(e.refreshFormKey).catch(t=>{console.error(t.message),clearInterval(u),a.removeChild(s),a.appendChild(displayErrorMessage(t)),setTimeout(()=>{a.innerHTML="",Array.from(e.getClosest(a,".sortable").querySelectorAll("button")).forEach(e=>{e.disabled=!1})},5e3)})},getStepAll=()=>{let t=make(["button",{type:"button",class:"stepAll"},"Confirm"]);return t.addEventListener("click",e.stepAll),t},e.stepAll=async t=>{t.preventDefault();let r={},l=[],n={},i={step:[],ticket_index:[]},a=e.getClosest(t.target,".sortable"),o=a.querySelectorAll(".message2"),s=o[o.length-1],c=make(["span",{class:"ellipsis"},"."]),u=a.querySelector(".printName");if(!0===u.required&&""===u.value)return u.classList.add("elementError"),setTimeout(()=>{u.classList.remove("elementError")},3e3),!1;s.innerHTML="",s.appendChild(c);let p=!0,h=setInterval(()=>{!0===p&&(c.innerHTML+="..",p=15>c.innerHTML.length&&1!=c.innerHTML.length),!1===p&&(c.innerHTML=c.innerHTML.slice(2),p=1===c.innerHTML.length)},500);Array.from(a.querySelectorAll(".routeStop")).forEach((e,t)=>{Array.from(document.querySelectorAll("input[form='"+e.getAttribute("id")+"'], textarea[form='"+e.getAttribute("id")+"']")).forEach(e=>{if("latitude"!==e.getAttribute("name")&&"longitude"!==e.getAttribute("name")&&(n[e.getAttribute("name")]="checkbox"===e.getAttribute("type")?+e.checked:e.value),"step"===e.getAttribute("name"))switch(e.value){case"pickedUp":i.step.push("p");break;case"delivered":i.step.push("d");break;case"returned":i.step.push("d2");}"ticket_index"===e.getAttribute("name")&&i.ticket_index.push(e.value)}),l[t]=n,n={}}),r.multiTicket=JSON.stringify(l),r.formKey=document.querySelector("#formKey").value,r.printName=u.value,r.sigImage=a.querySelector(".sigImage").value;let y;for(;!y||watch_id.hasOwnProperty(y);)y=psudorand();i.id=y,e.deliveryLocation(i),await e.fetch_template({url:"./updateStep.php",postData:r,headers:{"Content-Type":"application/x-www-form-urlencoded","Content-Length":JSON.stringify(r).length}}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(`${e.status} ${e.statusText}`)}).then(t=>{if(clearInterval(h),s.removeChild(c),-1!==t.indexOf("Session Error"))return watch_id[y]&&(navigator.geolocation.clearWatch(watch_id[y]),document.querySelector(`.dl${y}`)&&document.querySelector(`.dl${y}`).remove(),delete watch_id[y]),e.showLogin();if(-1===t.indexOf("error")){let r=parser.parseFromString(t,"text/html"),l=document.createDocumentFragment();Array.from(r.querySelectorAll(".result")).forEach(e=>{l.appendChild(e)}),s.appendChild(l),setTimeout(e.refreshRoute,3e3)}else throw new Error(t)}).then(e.refreshFormKey).catch(t=>{console.error(t.message),s.appendChild(displayErrorMessage(t)),setTimeout(()=>{s.innerHTML="",Array.from(e.getClosest(s,".sortable").querySelectorAll("button")).forEach(e=>{e.disabled=!1})},5e3)})},getCancelTicket=(t,r)=>{let l=make(["button",{type:"button",class:`confirm${r}`,form:t},"Confirm"]);return l.addEventListener("click",e.confirmCancel),l},e.confirmCancel=async t=>{t.preventDefault();let r,l,n={},i=e.getClosest(t.target,".message2"),a=make(["span",{class:"ellipsis"},"."]);i.innerHTML="",i.appendChild(a);let o=!0,s=setInterval(()=>{!0===o&&(a.innerHTML+="..",o=15>a.innerHTML.length&&1!=a.innerHTML.length),!1===o&&(a.innerHTML=a.innerHTML.slice(2),o=1===a.innerHTML.length)},500);Array.from(document.querySelectorAll("input[form="+t.target.getAttribute("form")+"], textarea[form="+t.target.getAttribute("form")+"]")).forEach(e=>{n[e.getAttribute("name")]=JSON.stringify(e.value)}),t.target.classList.contains("confirmDelete")&&(n.action="delete"),t.target.classList.contains("confirmCancelRun")&&(n.action="cancel"),t.target.classList.contains("confirmDeadRun")&&(n.action="deadRun",l="p"),t.target.classList.contains("confirmDeclined")&&(n.action="declined",l="d"),n.formKey=document.querySelector("#formKey").value;let c;for(;!c||watch_id.hasOwnProperty(c);)c=psudorand();l&&e.deliveryLocation({ticket_index:[n.ticket_index],step:[l],id:c}),await e.fetch_template({url:"./deleteContractTicket.php",postData:n,headers:{"Content-Type":"application/x-www-form-urlencoded","Content-Length":JSON.stringify(n).length}}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(`${e.status} ${e.statusText}`)}).then(t=>{if(clearInterval(s),-1!==t.indexOf("Session Error"))return watch_id[c]&&(navigator.geolocation.clearWatch(watch_id[c]),document.querySelector(`.dl${c}`)&&document.querySelector(`.dl${c}`).remove(),delete watch_id[c]),e.showLogin();if(-1===t.indexOf("error")){i.removeChild(a);let l=parser.parseFromString(t,"text/html"),o=document.createDocumentFragment();Array.from(l.querySelectorAll(".result")).forEach(e=>{o.appendChild(e)}),i.appendChild(o),setTimeout(async()=>{switch(e.getClosest(i,".page").getAttribute("id")){case"route":return await e.refreshRoute();case"on_call":return await e.refreshOnCall();case"active_tickets":if(clearElement(i),Array.from(e.getClosest(i,".sortable").querySelectorAll("button")).forEach(e=>{e.disabled=!1}),Array.from(e.getClosest(i,".sortable").querySelectorAll(".bold")).forEach(e=>{"Charge:"==e.innerText&&(r=e)}),!r)return;switch(r.nextSibling.remove(),n.action){case"delete":return e.getClosest(i,".sortable").remove();case"cancel":return r.after(" Canceled");case"deadRun":return r.after(" Dead Run");case"declined":return r.after(" Declined");}}},3e3)}else throw new Error(t)}).then(e.refreshFormKey).catch(t=>{console.error(t.message),clearInterval(s),i.removeChild(a),i.appendChild(displayErrorMessage(t)),setTimeout(()=>{i.innerHTML="",Array.from(e.getClosest(i,".sortable").querySelectorAll("button")).forEach(e=>{e.disabled=!1})},5e3)})},getTransferTicket=()=>{let t=make(["button",{type:"button",class:"confirmTransfer"},"Confirm"]);return t.addEventListener("click",e.transferTicket),t},e.transferTicket=async t=>{t.preventDefault();let r={},l=e.getClosest(t.target,".message2"),n=e.getClosest(t.target,".tickets"),i=e.getClosest(t.target,".page").getAttribute("id"),a=make(["span",{class:"ellipsis"},"."]);if(r.pendingReceiver=l.querySelector(".pendingReceiver").value,!r.pendingReceiver)return l.querySelector(".pendingReceiver").classList.add("elementError"),setTimeout(()=>{l.querySelector(".pendingReceiver").classList.remove("elementError"),Array.from(l.querySelectorAll("button")).forEach(e=>{e.disabled=!1})},3e3),!1;l.innerHTML="",l.appendChild(a);let o=!0,s=setInterval(()=>{!0===o&&(a.innerHTML+="..",o=15>a.innerHTML.length&&1!=a.innerHTML.length),!1===o&&(a.innerHTML=a.innerHTML.slice(2),o=1===a.innerHTML.length)},500);r.ticket_index=n.querySelector(".ticket_index").value,r.transfers=n.querySelector(".transfers").value,r.notes=n.querySelector(".notes").value,r.action="transfer",r.formKey=document.querySelector("#formKey").value,r.TransferState=1,await e.fetch_template({url:"./deleteContractTicket.php",postData:r,headers:{"Content-Type":"application/x-www-form-urlencoded","Content-Length":JSON.stringify(r).length}}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(`${e.status} ${e.statusText}`)}).then(t=>{if(clearInterval(s),-1!==t.indexOf("Session Error"))return e.showLogin();if(-1===t.indexOf("error")){l.removeChild(a);let e=parser.parseFromString(t,"text/html"),r=document.createDocumentFragment();Array.from(e.querySelectorAll(".result")).forEach(e=>{r.appendChild(e)}),l.appendChild(r)}else throw new Error(t)}).then(async()=>await e.refreshTransfers()).then(async()=>"route"===i?await e.refreshRoute():"on_call"===i?await e.refreshOnCall():void 0).then(e.refreshFormKey).catch(t=>{console.error(t.message),clearInterval(s),l.removeChild(a),l.appendChild(displayErrorMessage(t)),setTimeout(()=>{l.innerHTML="",Array.from(e.getClosest(l,".sortable").querySelectorAll("button")).forEach(e=>{e.disabled=!1})},5e3)})},getTransferGroup=()=>{let t=make(["button",{type:"button",class:"confirmAcceptTransferGroup"},"Confirm"]);return t.addEventListener("click",e.transferGroup),t},e.transferGroup=async t=>{let r=[],l={},n={},i=e.getClosest(t.target,".sortable"),a=i.querySelectorAll(".message2"),o=a[a.length-1],s=make(["span",{class:"ellipsis"},"."]);if(pendingReceiver=o.querySelector(".pendingReceiver").value,!pendingReceiver)return o.querySelector(".pendingReceiver").classList.add("elementError"),setTimeout(()=>{o.querySelector(".pendingReceiver").classList.remove("elementError"),Array.from(o.querySelectorAll("button")).forEach(e=>{e.disabled=!1})},3e3),!1;o.innerHTML="",o.appendChild(s);let c=!0,u=setInterval(()=>{!0===c&&(s.innerHTML+="..",c=15>s.innerHTML.length&&1!=s.innerHTML.length),!1===c&&(s.innerHTML=s.innerHTML.slice(2),c=1===s.innerHTML.length)},500);Array.from(i.querySelectorAll(".routeStop")).forEach((e,t)=>{Array.from(document.querySelectorAll("input[form='"+e.getAttribute("id")+"'], textarea[form='"+e.getAttribute("id")+"']")).forEach(e=>{l[e.getAttribute("name")]=JSON.stringify(e.value)}),l.pendingReceiver=pendingReceiver,l.transferState=1,r[t]=l,l={}}),n.multiTicket=JSON.stringify(r),n.TransferState=1,n.action="transfer",n.formKey=document.querySelector("#formKey").value,await e.fetch_template({url:"./deleteContractTicket.php",postData:n,headers:{"Content-Type":"application/x-www-form-urlencoded","Content-Length":JSON.stringify(n).length}}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(`${e.status} ${e.statusText}`)}).then(t=>{if(clearInterval(u),-1!==t.indexOf("Session Error"))return e.showLogin();if(-1===t.indexOf("error")){o.removeChild(s);let e=parser.parseFromString(t,"text/html"),r=document.createDocumentFragment();Array.from(e.querySelectorAll(".result")).forEach(e=>{r.appendChild(e)}),o.appendChild(r)}else throw new Error(t)}).then(e.refreshFormKey).then(e.refreshTransfers).then(e.refreshRoute).catch(t=>{console.error(t.message),clearInterval(u),o.removeChild(s),o.appendChild(displayErrorMessage(t)),setTimeout(()=>{o.innerHTML="",Array.from(e.getClosest(o,".sortable").querySelectorAll("button")).forEach(e=>{e.disabled=!1})},5e3)})},getTransferButton=t=>{let r=make(["button",{type:"button",class:`confirm${ucfirst(t)}`},"Confirm"]);return r.addEventListener("click",e.processTransfer),r},e.processTransfer=async t=>{let r,l=["confirmCancelTransfer","confirmDeclineTransfer","confirmAcceptTransfer"],n={},i=e.getClosest(t.target,".message2"),a=e.getClosest(t.target,".tickets"),o=make(["span",{class:"ellipsis"},"."]);Array.from(a.querySelectorAll("button")).forEach(e=>{e.disabled=!0}),i.innerHTML="",i.appendChild(o);let s=!0,c=setInterval(()=>{!0===s&&(o.innerHTML+="..",s=15>o.innerHTML.length&&1!=o.innerHTML.length),!1===s&&(o.innerHTML=o.innerHTML.slice(2),s=1===o.innerHTML.length)},500);n.formKey=document.querySelector("#formKey").value,n.action="transfer",n.pendingReceiver=0,Array.from(a.querySelectorAll("input, textarea")).forEach(e=>{n[e.getAttribute("name")]=JSON.stringify(e.value)});for(let e=0;e<t.target.classList.length;e++)if(l.indexOf(-1!==t.target.classList[e])){r=t.target.classList[e];break}"confirmCancelTransfer"===r?n.TransferState=2:"confirmDeclineTransfer"===r?n.TransferState=3:"confirmAcceptTransfer"===r?n.TransferState=4:void 0;await e.fetch_template({url:"./deleteContractTicket.php",postData:n,headers:{"Content-Type":"application/x-www-form-urlencoded","Content-Length":JSON.stringify(n).length}}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(`${e.status} ${e.statusText}`)}).then(t=>{if(clearInterval(c),o.remove(),-1!==t.indexOf("Session Error"))return e.showLogin();if(-1===t.indexOf("error")){let e=parser.parseFromString(t,"text/html"),r=document.createDocumentFragment();Array.from(e.querySelectorAll(".result")).forEach(e=>{r.appendChild(e)}),i.appendChild(r)}else throw new Error(t)}).then(e.refreshFormKey).then(async()=>"0"===a.querySelector(".rNum").innerText?await e.refreshOnCall():await e.refreshRoute()).then(async()=>{setTimeout(async()=>await e.refreshTransfers(),3500)}).catch(e=>{console.error(e.message),clearInterval(c),o.remove(),i.appendChild(displayErrorMessage(e)),setTimeout(()=>{i.innerHTML="",Array.from(a.querySelectorAll("button")).forEach(e=>{e.disabled=!1})},5e3)})},getTransferAllButton=t=>{let r=make(["button",{type:"button",class:`confirm${ucfirst(t)}`},"Confirm"]);return r.addEventListener("click",e.processTransferAll),r},e.processTransferAll=async t=>{let r,l,n=["confirmCancelTransferGroup","confirmDeclineTransferGroup","confirmAcceptTransferGroup"],i={},a={},o=[],s=e.getClosest(t.target,".sortable"),c=s.querySelectorAll(".message2"),u=c[c.length-1],p=make(["span",{class:"ellipsis"},"."]);a.formKey=document.querySelector("#formKey").value,u.innerHTML="",u.appendChild(p);let h=!0,y=setInterval(()=>{!0===h&&(p.innerHTML+="..",h=15>p.innerHTML.length&&1!=p.innerHTML.length),!1===h&&(p.innerHTML=p.innerHTML.slice(2),h=1===p.innerHTML.length)},500);for(let e=0;e<t.target.classList.length;e++)if(n.indexOf(-1!==t.target.classList[e])){l=t.target.classList[e];break}"confirmCancelTransferGroup"===l?r=2:"confirmDeclineTransferGroup"===l?r=3:"confirmAcceptTransferGroup"===l?r=4:void 0;a.TransferState=r,Array.from(s.querySelectorAll(".routeStop")).forEach((e,t)=>{Array.from(document.querySelectorAll("input[form='"+e.getAttribute("id")+"'], textarea[form='"+e.getAttribute("id")+"']")).forEach(e=>{i[e.getAttribute("name")]=JSON.stringify(e.value)}),i.transferState=r,i.action="transfer",o[t]=i,i={}}),a.multiTicket=JSON.stringify(o),await e.fetch_template({url:"./deleteContractTicket.php",postData:a,headers:{"Content-Type":"application/x-www-form-urlencoded","Content-Length":JSON.stringify(a).length}}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(`${e.status} ${e.statusText}`)}).then(t=>{if(clearInterval(y),-1!==t.indexOf("Session Error"))return e.showLogin();if(-1===t.indexOf("error")){u.removeChild(p);let e=parser.parseFromString(t,"text/html"),r=document.createDocumentFragment();Array.from(e.querySelectorAll(".result")).forEach(e=>{r.appendChild(e)}),u.appendChild(r)}else throw new Error(t)}).then(e.refreshFormKey).then(e.refreshRoute).then(e.refreshTransfers).catch(e=>{console.error(e.message),clearInterval(y),u.removeChild(p),u.appendChild(displayErrorMessage(e)),setTimeout(()=>{u.innerHTML="",Array.from(s.querySelectorAll("button")).forEach(e=>{e.disabled=!1})},5e3)})},e.assignRouteListeners=()=>assignTicketListeners(document.querySelector("#route.page")),e.assignOnCallListeners=()=>assignTicketListeners(document.querySelector("#on_call.page")),assignTicketListeners=t=>{if(!t)return;const r=async t=>{t.target.setAttribute("disable",!0);let r=e.getClosest(t.target,".tickets").querySelector(".message2");postData={},postData.ticket_index=document.querySelector(".ticket_index[form='"+t.target.getAttribute("form")+"']").value,postData.notes=document.querySelector(".notes[form='"+t.target.getAttribute("form")+"']").value,postData.formKey=document.querySelector("#formKey").value,await e.fetch_template({url:"./updateTicket.php",postData:postData,headers:{"Content-Type":"application/x-www-form-urlencoded","Content-Length":JSON.stringify(postData).length}}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(`${e.status} ${e.statusText}`)}).then(t=>{if(-1!==t.indexOf("Session Error"))return e.showLogin();if(-1===t.indexOf("error")){let e=parser.parseFromString(t,"text/html");r.appendChild(e.querySelector(".result")),setTimeout(()=>{r.innerHTML=""},3500)}else throw new Error(t)}).then(e.refreshFormKey).catch(e=>{console.error(e.message),r.appendChild(displayErrorMessage(e)),setTimeout(()=>{t.target.removeAttribute("disabled"),r.innerHTML=""},5e3)})};Array.from(t.querySelectorAll(".updateNotes")).forEach(e=>{e.removeEventListener("click",r),e.addEventListener("click",r)}),Array.from(t.querySelectorAll(".dTicket")).forEach(r=>{r.addEventListener("click",r=>{r.preventDefault();let l=e.getClosest(r.target,".tickets"),n=l.querySelector(".message2");Array.from(t.querySelectorAll(".cancelThis")).forEach(t=>{e.triggerEvent(t,"click")}),Array.from(l.querySelectorAll("button")).forEach(e=>{e.disabled=!0}),n.appendChild(make(["p",`Confirm ${r.target.innerText}`])),n.appendChild(getStepTicket(r.target.getAttribute("form"))),n.appendChild(getCancelThis())})}),Array.from(t.querySelectorAll(".confirmAll")).forEach(r=>{r.addEventListener("click",r=>{r.preventDefault();let l=e.getClosest(r.target,".sortable"),n=l.querySelectorAll(".message2"),i=n[n.length-1];Array.from(t.querySelectorAll(".cancelThis")).forEach(t=>{e.triggerEvent(t,"click")}),Array.from(l.querySelectorAll("button")).forEach(e=>{e.disabled=!0}),i.appendChild(make(["p","Confirm Group Update"])),i.appendChild(getStepAll()),i.appendChild(getCancelThis())})}),Array.from(t.querySelectorAll(".cancelRun, .deadRun, .declined")).forEach(r=>{r.addEventListener("click",r=>{let l,n=["cancelRun","deadRun","declined"],i=e.getClosest(r.target,".tickets"),a=i.querySelector(".message2"),o=r.target.getAttribute("form");Array.from(t.querySelectorAll(".cancelThis")).forEach(t=>{e.triggerEvent(t,"click")}),Array.from(i.querySelectorAll("button")).forEach(e=>{e.disabled=!0});for(let e=0;e<n.length;e++)if(r.target.classList.contains(n[e])){l=ucfirst(n[e]);break}a.appendChild(make(["p",`Confirm ${r.target.innerText}`])),a.appendChild(getCancelTicket(o,l)),a.appendChild(getCancelThis())})}),Array.from(t.querySelectorAll(".transferTicket")).forEach(r=>{r.addEventListener("click",r=>{let l=e.getClosest(r.target,".tickets"),n=l.querySelector(".message2");Array.from(t.querySelectorAll(".cancelThis")).forEach(t=>{e.triggerEvent(t,"click")}),Array.from(l.querySelectorAll("button")).forEach(e=>{e.disabled=!0}),n.appendChild(make(["p",`Confirm ${r.target.innerText}`])),n.appendChild(getTransferTicket()),n.appendChild(make(["input",{name:"pendingReceiver",class:"pendingReceiver",list:"receivers"}])),n.appendChild(getCancelThis())})}),Array.from(t.querySelectorAll(".transferGroup")).forEach(r=>{r.addEventListener("click",r=>{r.preventDefault();let l=e.getClosest(r.target,".sortable"),n=l.querySelectorAll(".message2"),i=n[n.length-1];Array.from(t.querySelectorAll(".cancelThis")).forEach(t=>{e.triggerEvent(t,"click")}),Array.from(l.querySelectorAll("button")).forEach(e=>{e.disabled=!0}),i.appendChild(make(["p","Confirm Transfer"])),i.appendChild(getTransferGroup()),i.appendChild(make(["input",{name:"pendingReceiver",class:"pendingReceiver",list:"receivers"}])),i.appendChild(getCancelThis())})})},e.assignTransferListeners=()=>{let t=document.querySelector("#transfers.page");t&&(Array.from(t.querySelectorAll(".cancelTransfer, .declineTransfer, .acceptTransfer")).forEach(r=>{r.addEventListener("click",r=>{r.preventDefault();let l,n=["cancelTransfer","declineTransfer","acceptTransfer"],i=e.getClosest(r.target,".tickets"),a=i.querySelector(".message2");Array.from(t.querySelectorAll(".cancelThis")).forEach(t=>{e.triggerEvent(t,"click")}),Array.from(i.querySelectorAll("button")).forEach(e=>{e.disabled=!0});for(let e=0;e<n.length;e++)if(r.target.classList.contains(n[e])){l=ucfirst(n[e]);break}a.appendChild(make(["p",`Confirm ${r.target.innerText}`])),a.appendChild(getTransferButton(l)),a.appendChild(getCancelThis())})}),Array.from(t.querySelectorAll(".acceptTransferGroup, .declineTransferGroup, .cancelTransferGroup")).forEach(r=>{r.addEventListener("click",r=>{r.preventDefault();let l,n=["acceptTransferGroup","declineTransferGroup","cancelTransferGroup"],i=e.getClosest(r.target,".sortable"),a=i.querySelectorAll(".message2"),o=a[a.length-1];Array.from(t.querySelectorAll(".cancelThis")).forEach(t=>{e.triggerEvent(t,"click")}),Array.from(i.querySelectorAll("button")).forEach(e=>{e.disabled=!0});for(let e=0;e<n.length;e++)if(r.target.classList.contains(n[e])){l=ucfirst(n[e]);break}o.appendChild(make(["p",`Confirm ${r.target.innerText}`])),o.appendChild(getTransferAllButton(l)),o.appendChild(getCancelThis())})}))},e.assignDispatchListeners=()=>{let t=document.querySelector("#dispatch.page");t&&Array.from(t.querySelectorAll(".stepTicket")).forEach(t=>{t.removeEventListener("click",e.stepTicket),t.addEventListener("click",e.stepTicket)})},e.assignActiveTicketsListeners=()=>{let t=document.querySelector("#active_tickets.page");t&&(t.querySelector("#ticketEditorSubmit")&&t.querySelector("#ticketEditorSubmit").addEventListener("click",async r=>{r.preventDefault();let l=t.querySelector("#ticketEditorResultContainer"),n={},i=document.querySelector("#ticketEditor"),a=make(["span",{class:"ellipsis"},"."]);if(Array.from(i.querySelectorAll("input[name], select")).forEach(e=>{n[e.getAttribute("name")]=e.value}),n.formKey=document.querySelector("#formKey").value,!n.dispatchedTo||!n.ticketEditorSearchDate)return!1;l.innerHTML="",l.appendChild(a);let o=!0,s=setInterval(()=>{!0===o&&(a.innerHTML+="..",o=15>a.innerHTML.length&&1!=a.innerHTML.length),!1===o&&(a.innerHTML=a.innerHTML.slice(2),o=1===a.innerHTML.length)},500);await e.fetch_template({url:"./activeTickets.php",postData:n,headers:{"Content-Type":"application/x-www-form-urlencoded","Content-Length":JSON.stringify(n).length}}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(`${e.status} ${e.statusText}`)}).then(t=>{if(clearInterval(s),l.removeChild(a),-1!==t.indexOf("Session Error"))return l.appendChild(make(["p",{class:"center"},"Select Driver &amp; Ticket Type"])),e.showLogin();let r=parser.parseFromString(t,"text/html"),n=document.createDocumentFragment();Array.from(r.querySelectorAll(".tickets")).forEach(e=>{n.appendChild(e)}),l.appendChild(n),assignTicketEditorListener()}).then(e.refreshFormKey).catch(e=>{console.error(e.message),clearInterval(s),l.removeChild(a),l.appendChild(displayErrorMessage(e)),setTimeout(()=>{element.innerHTML="Select Driver &amp; Ticket Type"},3500)})}),t.querySelector("#clearTicketEditorResults")&&t.querySelector("#clearTicketEditorResults").addEventListener("click",e=>{e.preventDefault();let t=document.querySelector("#ticketEditor"),r=new Date,l=10>r.getDate()?`0${r.getDate()}`:r.getDate(),n=r.getMonth()+1,i=10>n?`0${n}`:n;for(container=document.querySelector("#ticketEditorResultContainer"),t.querySelector(".dispatchedTo").value="",t.querySelector(".contract").value=0,t.querySelector("input.ticketEditorSearchDate").value=`${r.getFullYear()}-${i}-${l}`;container.firstChild;)container.removeChild(container.firstChild);container.appendChild(make(["p",{class:"center"},"Select Driver & Ticket Type"]))}))},e.assignPriceCalcListeners=()=>{let t=document.querySelector("#price_calculator.page");t&&(t.querySelector(".dryIce").addEventListener("change",t=>{let r=e.getClosest(t.target,"td");t.target.checked?(r.querySelector(".diWeight").value="0",r.querySelector(".diWeight").disabled=!1,r.querySelector(".diWeight").focus()):(r.querySelector(".diWeight").value="0",r.querySelector(".diWeight").disabled=!0)}),Array.from(t.querySelectorAll("input[list]")).forEach(t=>{"Address1"===t.getAttribute("name").slice(1)&&t.addEventListener("blur",t=>{let r;Array.from(document.querySelectorAll("#addy1 option")).forEach(e=>{e.value===t.target.value&&(r=e.getAttribute("data-value"))});"undefined"==typeof r||Array.from(document.querySelectorAll("#addy2 option")).forEach(l=>{l.getAttribute("data-value")===r&&(e.getClosest(t.target,"fieldset").querySelector("input[name='"+t.target.getAttribute("name").slice(0,-1)+"2']").value=l.value)})})}),t.querySelector(".clear").addEventListener("click",()=>{t.querySelector(".dryIce").checked=!1,e.triggerEvent(t.querySelector(".dryIce"),"change"),document.querySelector("#CalcCharge").value="0",Array.from(document.querySelectorAll("#pNotice, #dNotice, #rangeResult, #diWeightResult, #diPriceResult, #runPriceResult, #ticketPriceResult")).forEach(e=>{e.innerText=""}),Array.from(document.querySelectorAll("#priceResult .currencySymbol, #priceResult .weightMarker")).forEach(e=>{e.style.display="none"}),Array.from(document.querySelectorAll("#price_calculator .elementError")).forEach(e=>e.classList.remove("elementError")),e.updateMap({mapDivID:"map2"})}),t.querySelector(".submitPriceQuery").addEventListener("click",async r=>{r.preventDefault(),Array.from(t.querySelectorAll("button")).forEach(e=>{e.disabled=!0});let l=!1,n={},i=make(["span",{class:"ellipsis"},"."]);if(n.formKey=document.querySelector("#formKey").value,Array.from(t.querySelectorAll("input[name]")).forEach(e=>{e.getAttribute("list")&&!1===e.disabled&&""===e.value?(l=!0,e.classList.add("elementError"),setTimeout(()=>{e.classList.remove("elementError")},3500)):!1===e.disabled&&"checkbox"!==e.type&&(n[e.getAttribute("name")]=JSON.stringify(e.value)),"checkbox"===e.type&&(n[e.getAttribute("name")]=e.checked?1:0)}),1===n.dryIce&&("0"===n.diWeight||0!=n.diWeight%t.querySelector(".diWeight").getAttribute("step"))&&(l=!0,t.querySelector(".diWeight").classList.add("elementError"),t.querySelector(".ticketError").innerHTML="Dry Ice must be in increments of "+t.querySelector(".diWeight").getAttribute("step")),l)return setTimeout(()=>{Array.from(t.querySelectorAll("button, .elementError")).forEach(e=>{e.disabled=!1,e.classList.remove("elementError")}),t.querySelector(".ticketError").innerHTML=""},3500),!1;t.querySelector(".ticketError").innerHTML="",t.querySelector(".ticketError").appendChild(i);let a=!0,o=setInterval(()=>{!0===a&&(i.innerHTML+="..",a=15>i.innerHTML.length&&1!=i.innerHTML.length),!1===a&&(i.innerHTML=i.innerHTML.slice(2),a=1===i.innerHTML.length)},500);await e.fetch_template({url:"../priceCalc.php",postData:n,headers:{"Content-Type":"application/x-www-form-urlencoded","Content-Length":JSON.stringify(n).length}}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(`${e.status} ${e.statusText}`)}).then(r=>{if(clearInterval(o),t.querySelector(".ticketError").removeChild(i),-1!==r.indexOf("Session Error"))return e.showLogin();Array.from(document.querySelectorAll("#pNotice, #dNotice, #CalcError")).forEach(e=>{e.innerHTML=""});let l;try{l=JSON.parse(r)}catch(e){return document.querySelector("#CalcError").appendChild(displayErrorMessage(e)),setTimeout(()=>{document.querySelector("#CalcError").innerText=""},3500),!1}Array.from(document.querySelectorAll("#priceResult .currencySymbol, #priceResult .weightMarker")).forEach(e=>{e.classList.remove("hide")}),document.querySelector("#rangeResult").innerText=l.rangeDisplay,document.querySelector("#diWeightResult").innerText=l.diWeight,document.querySelector("#runPriceResult").innerText=l.runPrice,document.querySelector("#diPriceResult").innerText=l.diPrice,document.querySelector("#ticketPriceResult").innerText=l.ticketPrice,15<l.pRangeTest&&20>l.pRangeTest?document.querySelector("#pNotice").innerText="Pick Up address is outside of our standard range. Please call to confirm availability.":20<l.pRangeTest&&(document.querySelector("#pNotice").innerText="Pick Up address is outside of our extended range.",Array.from(document.querySelectorAll("#runPriceResult, #ticketPriceResult, #diPriceResult, #diWeightResult")).forEach(e=>{e.innerText=""}),Array.from(document.querySelectorAll("#priceResult .currencySymbol, #priceResult .weightMarker")).forEach(e=>{e.classList.add("hide")})),15<l.dRangeTest&&20>l.dRangeTest?document.querySelector("#dNotice").innerText="Delivery address is outside of our standard range. Please call to confirm availability.":20<l.dRangeTest&&(document.querySelector("#dNotice").innerText="Delivery address is outside of our extended range.",Array.from(document.querySelectorAll("#runPriceResult, #ticketPriceResult, #diPriceResult, #diWeightResult")).forEach(e=>{e.innerText=""}),Array.from(document.querySelectorAll("#priceResult .currencySymbol, #priceResult .weightMarker")).forEach(e=>{e.classList.add("hide")})),Array.from(t.querySelectorAll("button")).forEach(e=>{e.disabled=!1}),e.updateMap({mapDivID:"map2",coords1:l.result1,address1:l.address1,coords2:l.result2,address2:l.address2,center:l.center})}).then(e.refreshFormKey).catch(e=>{console.error(e.message),clearInterval(o),i.parentNode.removeChild(i),t.querySelector(".ticketError").appendChild(displayErrorMessage(e)),setTimeout(()=>{t.querySelector(".ticketError").innerHTML="",Array.from(t.querySelectorAll("button")).forEach(e=>{e.disabled=!1})},3500)})}))},e.assignPasswordListeners=()=>{Array.from(document.querySelectorAll(".PWcontainer .showText")).forEach(t=>{t.addEventListener("change",t=>{Array.from(e.getClosest(t.target,"form").querySelectorAll("input.currentPw, .newPw1, .newPw2")).forEach(e=>{e.type=t.target.checked?"text":"password"})})}),Array.from(document.querySelectorAll(".clearPWform")).forEach(t=>{t.addEventListener("click",t=>{e.getClosest(t.target,"form").querySelector(".showText").checked=!1,e.triggerEvent(e.getClosest(t.target,"form").querySelector(".showText"),"change")})}),Array.from(document.querySelectorAll(".newPw1, .newPw2, .currentPw")).forEach(t=>{t.addEventListener("change",t=>{let r=e.getClosest(t.target,".PWform"),l=r.querySelector(".PWsubmit"),n=r.querySelector(".currentPw").value,i=r.querySelector(".newPw1").value,a=r.querySelector(".newPw2").value,o=make(["p",{class:"error1"},["span",{class:"error"},"Error"],": Password does not meet criteria."]),s=make(["p",{class:"error1"},["span",{class:"error"},"Error"],": Password missmatch."]),c=make(["p",{class:"error1"},["span",{class:"error"},"Error"],": Password should be changed."]);if(""!==i){if(!!/^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#\$%\^\&*\)\(\{\}\[\]\-_.=+\?\:;,])(?=.{8,}).*$/.test(i))null!==r.querySelector(".message .error1")&&r.querySelector(".message").removeChild(r.querySelector(".message .error1")),null===r.querySelector(".message p")&&(l.disabled=!1);else if(null!==r.querySelector(".message .error1"))return r.querySelector(".message").appendChild(o),l.disabled=!0,!1;""!==n&&i===n?null===r.querySelector(".message .error3")&&(r.querySelector(".message").appendChild(c),l.disabled=!0):(null!==r.querySelector(".message .error3")&&r.querySelector(".message").removeChild(r.querySelector(".message .error3")),null===r.querySelector(".message p")&&(l.disabled=!1))}else null!==r.querySelector(".message .error1")&&r.querySelector(".message").removeChild(r.querySelector(".message .error1")),null===r.querySelector(".message p")&&(l.disabled=!1);""===a?(null!==r.querySelector(".message .error2")&&r.querySelector(".message").removeChild(r.querySelector(".message .error2")),null===r.querySelector(".message p")&&(l.disabled=!1)):i===a?(null!==r.querySelector(".message .error2")&&r.querySelector(".message").removeChild(r.querySelector(".message .error2")),null===r.querySelector(".message p")&&(l.disabled=!1)):(null===r.querySelector(".message .error2")&&r.querySelector(".message").appendChild(s),l.disabled=!0)})}),Array.from(document.querySelectorAll(".PWsubmit")).forEach(t=>{t.addEventListener("click",async t=>{t.preventDefault(),t.target.disabled=!0;let r=e.getClosest(t.target,".PWform"),l={},n=make(["span",{class:"ellipsis"},"."]);r.querySelector(".message").innerHTML="",r.querySelector(".message").appendChild(n);let i=!0,a=setInterval(()=>{!0===i&&(n.innerHTML+="..",i=15>n.innerHTML.length&&1!=n.innerHTML.length),!1===i&&(n.innerHTML=n.innerHTML.slice(2),i=1===n.innerHTML.length)},500);l.formKey=document.querySelector("#formKey").value,Array.from(r.querySelectorAll("input[name]")).forEach(e=>{l[e.getAttribute("name")]=e.value}),await e.fetch_template({url:"./changePW.php",postData:l,headers:{"Content-Type":"application/x-www-form-urlencoded","Content-Length":JSON.stringify(l).length}}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(`${e.status} ${e.statusText}`)}).then(i=>{if(clearInterval(a),n.parentNode.removeChild(n),-1!==i.indexOf("Session Error"))return t.target.disabled=!1,e.showLogin();let o=parser.parseFromString(i,"text/html"),s=document.createDocumentFragment();Array.from(o.querySelectorAll(".result")).forEach(e=>{s.appendChild(e)}),r.querySelector(".message").appendChild(s),setTimeout(()=>{if(Array.from(r.querySelectorAll(".currentPw, .newPw1, .newPw2")).forEach(e=>{e.value=""}),r.querySelector(".message").innerHTML="",r.querySelector(".currentPw").focus(),t.target.disabled=!1,"driver"!==l.flag&&"dispatch"!==l.flag){let r,n=e.getClosest(t.target,".page"),a=!1;switch(l.flag){case"daily":r=document.querySelector("a[data-id='change_password']"),a="!Delivery1"===l.newPw1;break;case"admin":r=document.querySelector("a[data-id='change_admin_password']"),a="!Delivery2"===l.newPw1;break;case"org":r=document.querySelector("a[data-id='change_password']"),a="3Delivery!"===l.newPw1;}-1!==i.search("Password Updated")&&(!0===a?(n.querySelector(".defaultWarning").classList.remove("hide"),r.querySelector(".PWalert").innerText="!"):(!n.querySelector(".defaultWarning").classList.contains("hide")&&n.querySelector(".defaultWarning").classList.add("hide"),r.querySelector(".PWalert").innerText=""))}},4e3)}).then(e.refreshFormKey).catch(e=>{console.error(e.message),clearInterval(a),n.parentNode.removeChild(n),r.querySelector(".message").appendChild(displayErrorMessage(e)),setTimeout(()=>{r.querySelector(".message").innerHTML="",t.target.disabled=!1},3500)})})})},e.assignListeners=()=>{e.assignRouteListeners(),e.assignOnCallListeners(),e.assignTransferListeners(),e.assignDispatchListeners(),e.assignActiveTicketsListeners(),e.assignPriceCalcListeners(),e.assignPasswordListeners(),assignTicketFormListeners(),document.querySelector("#invoiceQueryOptions")&&(document.querySelector("#useInvoice")&&document.querySelector("#useInvoice").addEventListener("change",t=>{document.querySelector("#invoiceNumber").disabled=!1===t.target.checked,Array.from(e.getClosest(t.target,"#singleInvoiceQuery").querySelectorAll(".dateIssuedMonth")).forEach(e=>{e.disabled=!0===t.target.checked,e.required=!1===t.target.checked})}),Array.from(document.querySelectorAll("#single, #multi")).forEach(e=>{e.addEventListener("click",e=>{e.target.checked||e.preventDefault()}),e.addEventListener("change",e=>{let t=[],r="single"===e.target.getAttribute("id")?"multi":"single",l=document.querySelector("#"+r).getAttribute("form");Array.from(document.querySelectorAll("#invoiceQueryOptions .orgMember")).forEach(r=>{r.checked&&t.push(r),r.checked=!1,r.setAttribute("form",e.target.getAttribute("form"))}),"single"==r&&(document.querySelector("#compareMembers").disabled=!0),e.target.checked&&(document.querySelector("#"+r).checked=!1),0<t.length&&(t[0].checked=!0),document.querySelector("button[form='"+e.target.getAttribute("form")+"']").disabled=!1,document.querySelector("button[form='"+l+"']").disabled=!0})}),Array.from(document.querySelectorAll("#invoiceQueryOptions .orgMember")).forEach(e=>{e.addEventListener("change",e=>{let t=0;Array.from(document.querySelectorAll("#invoiceQueryOptions .orgMember")).forEach(r=>{document.querySelector("#single").checked?r.checked=r===e.target:t+=r.checked}),document.querySelector("#compareMembers").disabled=2>t})}),document.querySelector("#single")&&e.triggerEvent(document.querySelector("#single"),"change"),Array.from(document.querySelectorAll("#singleInvoice, #rangeInvoice")).forEach(t=>{t.addEventListener("click",async t=>{t.preventDefault(),t.target.disabled=!0;let r=!1,l={},n=make(["p",{class:"center ellipsis"},"."]);if(Array.from(document.querySelectorAll("input[form='"+t.target.getAttribute("form")+"'], select[form='"+t.target.getAttribute("form")+"']")).forEach(e=>{e.required&&""===e.value&&(r=!0,e.classList.add("elementError"),setTimeout(()=>{e.classList.remove("elementError")},3e3)),"[]"===e.getAttribute("name").slice(-2)?"undefined"==typeof l[e.getAttribute("name").slice(0,-2)]?"checkbox"===e.type?!0===e.checked&&!1===e.disabled&&(l[e.getAttribute("name").slice(0,-2)]=[e.value]):!1===e.disabled&&(l[e.getAttribute("name").slice(0,-2)]=[e.value]):"checkbox"===e.type?!0===e.checked&&!1===e.disabled&&l[e.getAttribute("name").slice(0,-2)].push(e.value):!1===e.disabled&&l[e.getAttribute("name").slice(0,-2)].push(e.value):"checkbox"===e.type?!0===e.checked&&!1===e.disabled&&(l[e.getAttribute("name")]=e.value):!1===e.disabled&&(l[e.getAttribute("name")]=e.value)}),r)return t.target.disabled=!1,!1;clearElement(document.querySelector("#invoiceQueryResults")),document.querySelector("#invoiceQueryResults").appendChild(n);let i=!0,a=setInterval(()=>{!0===i&&(n.innerHTML+="..",i=15>n.innerHTML.length&&1!=n.innerHTML.length),!1===i&&(n.innerHTML=n.innerHTML.slice(2),i=1===n.innerHTML.length)},500);l.formKey=document.querySelector("#formKey").value,await e.fetch_template({url:"./buildQuery.php",postData:l,headers:{"Content-Type":"application/x-www-form-urlencoded","Content-Length":JSON.stringify(l).length}}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(`${e.status} ${e.statusText}`)}).then(r=>{if(clearInterval(a),document.querySelector("#invoiceQueryResults").removeChild(n),-1!==r.indexOf("Session Error"))return e.showLogin();let l=parser.parseFromString(r,"text/html"),i=document.createDocumentFragment();Array.from(l.querySelectorAll("#invoiceChartPDFform, .bargraph, .graphKey, #invoice, .invoiceTable, p.displayHeader, .result")).forEach(e=>{i.appendChild(e)}),document.querySelector("#invoiceQueryResults").appendChild(i),t.target.disabled=!1,assignQueriedInvoiceListeners()}).then(e.refreshFormKey).catch(e=>{console.error(e.message),clearInterval(a),n.parentNode.removeChild(n),document.querySelector("#invoiceQueryResults").appendChild(displayErrorMessage(e)),setTimeout(()=>{clearElement(document.querySelector("#invoiceQueryResults")),t.target.disabled=!1},3500)})})})),document.querySelector("#deliveryQuery")&&(Array.from(document.querySelectorAll("#deliveryQuery .orgMember")).forEach(t=>{t.addEventListener("change",t=>{e.disableButtonsTickets(),t.target.checked?(document.querySelector("#ticketNumber").value="",document.querySelector("#ticketNumber").readOnly=!0,e.triggerEvent(document.querySelector("#ticketNumber"),"change")):document.querySelector("#ticketNumber").readOnly="chart"===document.querySelector("#display").value})}),document.querySelector("#display")&&document.querySelector("#display").addEventListener("change",e=>{document.querySelector("#compareBox")&&Array.from(document.querySelectorAll("#compareBox, #compareMembersTickets")).forEach(t=>{t.disabled="tickets"===e.target.value,"tickets"===e.target.value&&(t.checked=!1)}),document.querySelector("#ticketNumber").disabled="chart"===e.target.value||"tickets"===e.target.value&&!0===document.querySelector("#allTime").checked,Array.from(document.querySelectorAll("#chargeHistory, #type")).forEach(t=>{t.disabled="chart"===e.target.value}),Array.from(document.querySelectorAll("#deliveryQuery .ticketDate, #deliveryQuery .chartDate")).forEach(t=>{"tickets"===e.target.value?(t.style.display=t.classList.contains("ticketDate")?"inline-block":"none",t.querySelector("input")&&Array.from(t.querySelectorAll("input")).forEach(e=>{e.disabled=e.classList.contains("startDateMonth")||e.classList.contains("endDateMonth"),e.value="",!1===e.disabled&&(e.disabled=document.querySelector("#allTime").checked)})):(t.style.display=t.classList.contains("ticketDate")?"none":"inline-block",t.querySelector("input")&&Array.from(t.querySelectorAll("input")).forEach(e=>{e.disabled=!e.classList.contains("startDateMonth")&&!e.classList.contains("endDateMonth"),e.value="",!1===e.disabled&&(e.disabled=document.querySelector("#allTime").checked)}))})}),document.querySelector("#allTime").addEventListener("change",t=>{let r=document.querySelector("#display")&&"chart"===document.querySelector("#display").value?".chartDate":".ticketDate";!0===t.target.checked?Array.from(e.getClosest(t.target,"form").querySelectorAll(r+" input, #ticketNumber")).forEach(e=>{e.value="",e.disabled=!0}):(Array.from(e.getClosest(t.target,"form").querySelectorAll(r+" input")).forEach(e=>{e.disabled=!1}),document.querySelector("#ticketNumber").disabled=!!document.querySelector("#display")&&"chart"===document.querySelector("#display").value)}),document.querySelector("#ticketNumber").addEventListener("blur",t=>{""===t.target.value?(Array.from(document.querySelectorAll("#deliveryQuery .startDateDate, #deliveryQuery .endDateDate, #chargeHistory, #charge, #type, #allTime, #display, #compareBox, #compareMembersTickets, #deliveryQuery .orgMember")).forEach(e=>{e.disabled=!1,e.required=e.classList.contains("startDate")||e.classList.contains("endDate")}),Array.from(document.querySelectorAll("#deliveryQuery .startDateMarker, #deliveryQuery .endDateMarker, #deliveryQuery .chargeMarker, #deliveryQuery .typeMarker, #displayMarker")).forEach(e=>{e.disabled=!0})):(document.querySelector("#display")&&(document.querySelector("#display").value="tickets",e.triggerEvent(document.querySelector("#display"),"change")),Array.from(document.querySelectorAll("#deliveryQuery .startDateDate, #deliveryQuery .endDateDate, #chargeHistory, #charge, #type, #allTime, #display, #compareBox, #compareMembersTickets, #deliveryQuery .orgMember")).forEach(e=>{e.disabled=!0,e.checked=!1,e.required=!1}),Array.from(document.querySelectorAll("#deliveryQuery .startDateMarker, #deliveryQuery .endDateMarker, #deliveryQuery .chargeMarker, #deliveryQuery .typeMarker, #displayMarker")).forEach(e=>{e.disabled=!1}))}),document.querySelector(".submitOrgTickets")?document.querySelector(".submitOrgTickets").addEventListener("click",async t=>{t.preventDefault();let r={},l=make(["p",{class:"center ellipsis"},"."]);r.formKey=document.querySelector("#formKey").value,document.querySelector("#ticketQueryResults").appendChild(l);let n=!0,i=setInterval(()=>{!0===n&&(l.innerHTML+="..",n=15>l.innerHTML.length&&1!=l.innerHTML.length),!1===n&&(l.innerHTML=l.innerHTML.slice(2),n=1===l.innerHTML.length)},500);Array.from(document.querySelectorAll("#deliveryQuery input, #deliveryQuery select")).forEach(e=>{e.disabled||e.readOnly||("[]"===e.getAttribute("name").slice(-2)?("checkbox"===e.getAttribute("type")&&e.checked||"checkbox"!==e.getAttribute("type")&&""!==e.value)&&("undefined"==typeof r[e.getAttribute("name").slice(0,e.getAttribute("name").length-2)]?r[e.getAttribute("name").slice(0,e.getAttribute("name").length-2)]=[e.value]:("object"==typeof r[e.getAttribute("name").slice(0,e.getAttribute("name").length-2)]||"array"==typeof r[e.getAttribute("name").slice(0,e.getAttribute("name").length-2)])&&r[e.getAttribute("name").slice(0,e.getAttribute("name").length-2)].push(e.value)):"checkbox"===e.getAttribute("type")?e.checked&&(r[e.getAttribute("name")]=e.value):r[e.getAttribute("name")]=e.value)}),await e.fetch_template({url:"./buildQuery.php",postData:r,headers:{"Content-Type":"application/x-www-form-urlencoded","Content-Length":JSON.stringify(r).length}}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(`${e.status} ${e.statusText}`)}).then(r=>{if(t.target.disabled=!1,clearInterval(i),l.parentNode.removeChild(l),-1!==r.indexOf("Session Error"))return e.showLogin();let n=parser.parseFromString(r,"text/html"),a=document.createDocumentFragment();Array.from(n.querySelectorAll("#ticketPDFform, .tickets, .ticketTable, .bargraph, .graphKey, .result")).forEach(e=>{a.appendChild(e)}),clearElement(document.querySelector("#ticketQueryResults")),document.querySelector("#ticketQueryResults").appendChild(a),e.assignQueriedTicketListeners()}).then(e.refreshFormKey).catch(e=>{console.error(e.message),t.target.disabled=!1,clearInterval(i),l.parentNode.removeChild(l),document.querySelector("#ticketQueryResults").appendChild(displayErrorMessage(e)),setTimeout(()=>{clearElement(document.querySelector("#ticketQueryResults"))},3500)})}):(document.querySelector(".clearTicketResults").addEventListener("click",()=>{clearElement(document.querySelector("#ticketQueryResults"))}),document.querySelector(".resetTicketQuery").addEventListener("click",()=>{document.querySelector("#display").value="tickets",e.triggerEvent(document.querySelector("#display"),"change"),Array.from(document.querySelectorAll("#deliveryQuery .elementError")).forEach(e=>{e.classList.remove("elementError")})}),document.querySelector(".submitTicketQuery").addEventListener("click",async t=>{t.preventDefault(),t.target.disabled=!0;let r=!1,l={},n=make(["p",{class:"center ellipsis"},"."]);if(Array.from(document.querySelectorAll("#deliveryQuery input, #deliveryQuery select")).forEach(e=>{e.disabled||("checkbox"===e.type?l[e.getAttribute("name")]=e.checked?1:0:e.value&&(l[e.getAttribute("name")]=e.value))}),l.hasOwnProperty("ticketNumber")||l.allTime?!l.ticketNumber&&!l.allTime&&(r=!0,document.querySelector("#ticketNumber").classList.add("elementError"),setTimeout(()=>{document.querySelector("#ticketNumber").classList.remove("elementError")},3500)):(!l.hasOwnProperty("startDate")||!l.startDate||!l.hasOwnProperty("endDate")||!l.endDate)&&(r=!0,Array.from(document.querySelectorAll("#deliveryQuery input[name='startDate'], #deliveryQuery input[name='endDate']")).forEach(e=>{e.value||(e.classList.add("elementError"),setTimeout(()=>{e.classList.remove("elementError")},3500))})),l.formKey=document.querySelector("#formKey").value,r)return t.target.disabled=!1,!1;document.querySelector("#ticketQueryResults").appendChild(n);let i=!0,a=setInterval(()=>{!0===i&&(n.innerHTML+="..",i=15>n.innerHTML.length&&1!=n.innerHTML.length),!1===i&&(n.innerHTML=n.innerHTML.slice(2),i=1===n.innerHTML.length)},500);await e.fetch_template({url:"./buildQuery.php",postData:l,headers:{"Content-Type":"application/x-www-form-urlencoded","Content-Length":JSON.stringify(l).length}}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(`${e.status} ${e.statusText}`)}).then(r=>{if(t.target.disabled=!1,clearInterval(a),n.parentNode.removeChild(n),-1!==r.indexOf("Session Error"))return e.showLogin();let l=parser.parseFromString(r,"text/html"),i=document.createDocumentFragment();Array.from(l.querySelectorAll("#ticketPDFform, .bargraph, .graphKey, .tickets, .ticketTable, .ticketGraphContainer, .result")).forEach(e=>{i.appendChild(e)}),clearElement(document.querySelector("#ticketQueryResults")),document.querySelector("#ticketQueryResults").appendChild(i),e.assignQueriedTicketListeners()}).then(e.refreshFormKey).catch(e=>{console.error(e.message),t.target.disabled=!1,clearInterval(a),n.parentNode.removeChild(n),document.querySelector("#ticketQueryResults").appendChild(displayErrorMessage(e)),setTimeout(()=>{clearElement(document.querySelector("#ticketQueryResults"))},3500)})}))),document.querySelector("#clientUpdateForm")&&(document.querySelector("#Same").addEventListener("change",t=>{Array.from(document.querySelectorAll("input[name='BillingName'], input[name='BillingAddress1'], input[name='BillingAddress2'], input[name='BillingCountry']")).forEach(e=>{e.disabled=!0===t.target.checked,e.required=!1===t.target.checked}),Array.from(document.querySelectorAll("fieldset[name='billingInfo'] .error")).forEach(e=>{e.style.display=!0===t.target.checked?"none":"inline"}),e.getClosest(document.querySelector("input[name='BillingCountry'][form='clientUpdate']"),"tr").classList.contains("hide")&&(document.querySelector("input[name='BillingCountry'][form='clientUpdate']").value=document.querySelector("input[name='ShippingCountry'][form='clientUpdate']").value)}),document.querySelector("#enableInfoUpdate").addEventListener("change",e=>{document.querySelector("#submitInfoUpdate").disabled=!1===e.target.checked}),document.querySelector("#submitInfoUpdate").addEventListener("click",async t=>{t.preventDefault(),t.target.disabled=!0;let r={},l=!1,n=make(["span",{class:"ellipsis"},"."]);if(Array.from(document.querySelectorAll("input[form='"+t.target.getAttribute("form")+"']")).forEach(e=>{!0===e.required&&""===e.value&&(console.log(e),l=!0,e.classList.add("elementError"),setTimeout(()=>{e.classList.remove("elementError")},3e3)),!1===e.disabled&&(r[e.getAttribute("name")]=e.value),"checkbox"===e.type&&(r[e.getAttribute("name")]=!0===e.checked?1:0)}),!0==l)return t.target.disabled=!1,!1;document.querySelector("#clientUpdateResult").appendChild(n);let i=!0,a=setInterval(()=>{!0===i&&(n.innerHTML+=".",i=15>n.innerHTML.length&&1!=n.innerHTML.length),!1===i&&(n.innerHTML=n.innerHTML.slice(2),i=1===n.innerHTML.length)},500);r.formKey=document.querySelector("#formKey").value,await e.fetch_template({url:"./updateClientInfo.php",postData:r,headers:{"Content-Type":"application/x-www-form-urlencoded","Content-Length":JSON.stringify(r).length}}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(`${e.status} ${e.statusText}`)}).then(r=>{if(t.target.disabled=!1,clearInterval(a),document.querySelector("#clientUpdateResult").removeChild(n),-1!==r.indexOf("Session Error"))return e.showLogin();let l=parser.parseFromString(r,"text/html"),i=document.createDocumentFragment();Array.from(l.querySelectorAll(".result")).forEach(e=>{i.appendChild(e)}),document.querySelector("#clientUpdateResult").appendChild(i),setTimeout(()=>{clearElement(document.querySelector("#clientUpdateResult")),document.querySelector("#enableInfoUpdate").checked=!1,e.triggerEvent(document.querySelector("#enableInfoUpdate"),"change")},3500)}).then(e.refreshFormKey).catch(e=>{console.error(e.message),t.target.disabled=!1,clearInterval(a),document.querySelector("#clientUpdateResult").removeChild(n),document.querySelector("#clientUpdateResult").appendChild(displayErrorMessage(e)),setTimeout(()=>{clearElement(document.querySelector("#clientUpdateResult"))},3500)})}))},assignQueriedInvoiceListeners=()=>{document.querySelector("#invoicePDF")&&document.querySelector("#invoicePDF").addEventListener("click",e=>{e.preventDefault();let t,r=document.querySelector("#invoice").cloneNode(!0),l={},n=["position","top","left","right","font-size"];if(null!==document.querySelector("#invoice .vatNotice"))for(let e in t=getComputedStyle(document.querySelector("#invoice .vatNotice")),t)-1!==n.indexOf(e)&&(l[e]=t.getPropertyValue(e));r.querySelector("#invoicePDFform").remove(),Array.from(r.querySelectorAll(".vatNotice")).forEach(e=>{for(let t in e.parentNode.style.position="relative",l)e.style[t]=l[t]}),document.querySelector("#invoicePDFform input[name='content']").value=r.outerHTML,document.querySelector("#invoicePDFform input[name='formKey']").value=document.querySelector("#formKey").value,document.querySelector("#formKey").value=+document.querySelector("#formKey").value+1,document.querySelector("#invoicePDFform").submit()}),document.querySelector("#invoiceChartPDF")&&document.querySelector("#invoiceChartPDF").addEventListener("click",t=>{t.preventDefault();let r=document.querySelector("#invoiceQueryResults").cloneNode(!0);r.querySelector("#invoiceChartPDFform").remove(),Array.from(r.querySelectorAll(".invoiceQuery")).forEach(t=>{let r=e.getClosest(t,"td"),l=t.innerHTML,n=Array.from(t.classList);r.classList.add(...n),r.innerHTML=l}),document.querySelector("#invoiceChartPDFform input[name='content']").value=r.outerHTML,document.querySelector("#invoiceChartPDFform input[name='formKey']").value=document.querySelector("#formKey").value,document.querySelector("#invoiceChartPDFform").submit(),e.refreshFormKey()}),Array.from(document.querySelectorAll("#invoiceQueryResults .invoiceQuery")).forEach(t=>{t.addEventListener("click",async t=>{t.preventDefault(),t.target.classList.add("red"),t.target.disabled=!0,setTimeout(()=>{t.target.classList.remove("red")},3500);let r={},l=make(["p",{class:"center ellipsis"},"."]);e.getClosest(t.target,".invoiceTable").appendChild(l);let n=!0,i=setInterval(()=>{!0===n&&(l.innerHTML+="..",n=15>l.innerHTML.length&&1!=l.innerHTML.length),!1===n&&(l.innerHTML=l.innerHTML.slice(2),n=1===l.innerHTML.length)},500);Array.from(e.getClosest(t.target,"form").querySelectorAll("input")).forEach(e=>{r[e.getAttribute("name")]=e.value}),r.formKey=document.querySelector("#formKey").value,await e.fetch_template({url:"./buildQuery.php",postData:r,headers:{"Content-Type":"application/x-www-form-urlencoded","Content-Length":JSON.stringify(r).length}}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(`${e.status} ${e.statusText}`)}).then(t=>{if(clearInterval(i),l.parentNode.removeChild(l),-1!==t.indexOf("Session Error"))return e.showLogin();let r=parser.parseFromString(t,"text/html"),n=document.createDocumentFragment();Array.from(r.querySelectorAll("#invoice, .invoiceTable, .invoiceGraphContainer, p.displayHeader, .result")).forEach(e=>{n.appendChild(e)}),document.querySelector("#invoiceQueryResults").appendChild(n)}).then(e.refreshFormKey).catch(r=>{console.log(r.message),clearInterval(i),e.getClosest(t.target,".invoiceTable").removeChild(l),e.getClosest(t.target,".invoiceTable").appendChild(displayErrorMessage(r)),setTimeout(()=>{e.getClosest(t.target,".invoiceTable").innerHTML="",t.target.disabled=!1},3500)})})}),document.querySelector("#invoiceQueryResults .invoiceTable")&&(Array.from(document.querySelectorAll("#invoiceQueryResults .invoiceTable, #invoiceQueryResults .invoiceGraphContainer")).forEach(t=>{t.addEventListener("touchstart",()=>{e.Swipe.disable()})}),Array.from(document.querySelectorAll("#invoiceQueryResults .invoiceTable, #invoiceQueryResults .invoiceGraphContainer")).forEach(t=>{t.addEventListener("touchend",()=>{e.Swipe.enable()})}))},e.assignQueriedTicketListeners=()=>{Array.from(document.querySelectorAll("#ticketQueryResults .invoiceQuery")).forEach(t=>{t.addEventListener("click",async t=>{t.preventDefault();let r={},l=make(["p",{class:"center ellipsis"},"."]);Array.from(e.getClosest(t.target,"form").querySelectorAll("input")).forEach(e=>{r[e.getAttribute("name")]=e.value}),r.formKey=document.querySelector("#formKey").value,clearElement(document.querySelector("#invoiceQueryResults")),document.querySelector("#invoiceQueryResults").appendChild(l),e.Swipe.slide(document.querySelector("a.nav[data-id='invoice_query']").getAttribute("data-value"),300);let n=!0,i=setInterval(()=>{!0===n&&(l.innerHTML+="..",n=15>l.innerHTML.length&&1!=l.innerHTML.length),!1===n&&(l.innerHTML=l.innerHTML.slice(2),n=1===l.innerHTML.length)},500);await e.fetch_template({url:"./buildQuery.php",postData:r,headers:{"Content-Type":"application/x-www-form-urlencoded","Content-Length":JSON.stringify(r).length}}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(`${e.status} ${e.statusText}`)}).then(t=>{if(clearInterval(i),l.parentNode.removeChild(l),-1!==t.indexOf("Session Error"))return e.showLogin();let r=parser.parseFromString(t,"text/html"),n=document.createDocumentFragment();Array.from(r.querySelectorAll("#invoice, .result")).forEach(e=>{n.appendChild(e)}),document.querySelector("#invoiceQueryResults").appendChild(n),assignQueriedInvoiceListeners()}).then(e.refreshFormKey).catch(e=>{console.error(e.message),clearInterval(i),l.parentNode.removeChild(l),document.querySelector("#invoiceQueryResults").appendChild(displayErrorMessage(e)),setTimeout(()=>{clearElement(document.querySelector("#invoiceQueryResults"))},3500)})})}),Array.from(document.querySelectorAll("#ticketQueryResults .sigPrint td")).forEach(e=>{e.addEventListener("click",e=>{let t=e.target.parentElement.nextElementSibling;t.style.display="none"===t.style.display||""===t.style.display?"block":"none"})}),Array.from(document.querySelectorAll("#ticketQueryResults .submitTicketQuery")).forEach(t=>{t.addEventListener("click",async t=>{t.preventDefault(),t.target.disabled=!0;let r={},l=make(["p",{class:"center ellipsis"},"."]);Array.from(e.getClosest(t.target,"form").querySelectorAll("input")).forEach(e=>{e.value&&(r[e.getAttribute("name")]=e.value)}),r.formKey=document.querySelector("#formKey").value;document.querySelector("#ticketQueryResults").appendChild(l);let n=!0,i=setInterval(()=>{!0===n&&(l.innerHTML+="..",n=15>l.innerHTML.length&&1!=l.innerHTML.length),!1===n&&(l.innerHTML=l.innerHTML.slice(2),n=1===l.innerHTML.length)},500);await e.fetch_template({url:"./buildQuery.php",postData:r,headers:{"Content-Type":"application/x-www-form-urlencoded","Content-Length":JSON.stringify(r).length}}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(`${e.status} ${e.statusText}`)}).then(r=>{if(t.target.disabled=!1,clearInterval(i),l.parentNode.removeChild(l),-1!==r.indexOf("Session Error"))return e.showLogin();let n=parser.parseFromString(r,"text/html"),a=document.createDocumentFragment();Array.from(n.querySelectorAll(".tickets, .result")).forEach(e=>{a.appendChild(e)}),document.querySelector("#ticketQueryResults").appendChild(a),e.assignQueriedTicketListeners()}).then(e.refreshFormKey).catch(e=>{console.error(e.message),t.target.disabled=!1,clearInterval(i),l.parentNode.removeChild(l),document.querySelector("#ticketQueryResults").appendChild(displayErrorMessage(e)),setTimeout(()=>{clearElement(document.querySelector("#ticketQueryResults"))},3500)})})}),document.querySelector("#ticketPDF")&&document.querySelector("#ticketPDF").addEventListener("click",e=>{e.preventDefault();let t=document.querySelector("#ticketQueryResults").cloneNode(!0);t.querySelector("#ticketPDF").remove(),Array.from(t.querySelectorAll(".submitTicketQuery")).forEach(e=>{e.parentNode.remove()}),document.querySelector("#ticketPDFform input[name='content']").value=t.outerHTML,document.querySelector("#ticketPDFform input[name='formKey']").value=document.querySelector("#formKey").value,document.querySelector("#formKey").value=+document.querySelector("#formKey").value+1,document.querySelector("#ticketPDFform").submit()}),document.querySelector("#ticketQueryResults .bargraph")&&(document.querySelector("#ticketQueryResults .bargraph").addEventListener("touchstart",()=>{e.Swipe.disable()}),document.querySelector("#ticketQueryResults .bargraph").addEventListener("touchend",()=>{e.Swipe.enable()}))},assignTicketEditorListener=()=>{Array.from(document.querySelectorAll("#ticketEditorResultContainer button.ticketEditor")).forEach(t=>{t.getAttribute("data-assigned")||(t.setAttribute("data-assigned",1),t.addEventListener("click",async t=>{t.target.classList.add("red"),setTimeout(()=>{t.target.classList.remove("red")},3e3);let r=e.getClosest(t.target,".sortable"),l={};l.ticket_index=t.target.getAttribute("data-index"),l.ticketEditor=1,l.formKey=document.querySelector("#formKey").value,await e.fetch_template({url:"./enterTicket.php",postData:l,headers:{"Content-Type":"application/x-www-form-urlencoded","Content-Length":JSON.stringify(l).length}}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(`${e.status} ${e.statusText}`)}).then(t=>{if(-1!==t.indexOf("Session Error"))return e.showLogin();let l=parser.parseFromString(t,"text/html"),n=document.createDocumentFragment();if(Array.from(r.querySelectorAll("table, hr, button.ticketEditor")).forEach(e=>{e.classList.add("hide")}),Array.from(l.querySelectorAll(".removableByEditor")).forEach(e=>{n.appendChild(e)}),r.appendChild(n),r.parentNode.querySelector("datalist"))for(;r.parentNode.querySelector("datalist");)r.parentNode.removeChild(r.parentNode.querySelector("datalist"));Array.from(l.querySelectorAll("datalist")).forEach(e=>{r.parentNode.prepend(e)}),assignTicketFormListeners()}).then(e.refreshFormKey).catch(e=>{console.error(e.message),r.appendChild(displayErrorMessage(e)),setTimeout(()=>{r.removeChild(message)},3500)})}))}),Array.from(document.querySelectorAll("#ticketEditorResultContainer button.cancelRun")).forEach(t=>{t.addEventListener("click",t=>{let r,l=["cancelRun","deadRun","declined"],n=e.getClosest(t.target,".page"),i=e.getClosest(t.target,".tickets"),a=i.querySelector(".message2"),o=t.target.getAttribute("form");Array.from(n.querySelectorAll(".cancelThis")).forEach(t=>{e.triggerEvent(t,"click")}),Array.from(i.querySelectorAll("button")).forEach(e=>{e.disabled=!0});for(let e=0;e<l.length;e++)if(t.target.classList.contains(l[e])){r=ucfirst(l[e]);break}a.appendChild(make(["p",`Confirm ${t.target.innerText}`])),a.appendChild(getCancelTicket(o,r)),a.appendChild(getCancelThis())})})},assignTicketFormListeners=()=>{let t=document.querySelector("#delivery_request")||document.querySelector("#ticket_entry");if(!t||!t.querySelector(".billTo"))return;document.querySelector("#switchTerms")&&document.querySelector("#switchTerms").addEventListener("click",()=>{document.querySelector("#deliveryTerms").classList.toggle("hide")});let r=e=>{t.querySelector(".billTo").setAttribute("list",e.target.checked?"t_clients":"clients"),t.querySelector(".billTo").value="",t.querySelector("checkbox.contract")&&(t.querySelector(".contract").disabled=e.target.checked,e.target.checked&&(t.querySelector(".contract").checked=!1))};if(t.querySelector(".repeat")&&(t.querySelector(".repeat").removeEventListener("change",r),t.querySelector(".repeat").addEventListener("change",r)),t.querySelector("[name=repeatClient]")&&"hidden"==t.querySelector("[name=repeatClient]").getAttribute("type").toLowerCase()){let e=e=>{let r=e.target.value;if(""!=r){let e=r.split(";"),l=-1==e[e.length-1].indexOf("t")?1:0;t.querySelector("[name=repeatClient]")&&(t.querySelector("[name=repeatClient]").value=l)}};t.querySelector(".billTo")&&(t.querySelector(".billTo").removeEventListener("change",e),t.querySelector(".billTo").addEventListener("change",e))}let l=t=>{let r=e.getClosest(t.target,"form");"0"===t.target.value?(r.querySelector(".emailAddress").required=!1,r.querySelector(".emailNote")&&r.querySelector(".emailNote").classList.add("hide")):(r.querySelector(".emailAddress").required=!0,r.querySelector(".emailNote")&&r.querySelector(".emailNote").classList.remove("hide"))};t.querySelector(".emailConfirm").removeEventListener("change",l),t.querySelector(".emailConfirm").addEventListener("change",l);let n=t=>{let r=e.getClosest(t.target,"fieldset");t.target.checked?(r.querySelector(".diWeight").value="0",r.querySelector(".diWeight").disabled=!1,r.querySelector(".diWeight").focus(),r.querySelector(".diWeightMarker").value="0",r.querySelector(".diWeightMarker").disabled=!0):(r.querySelector(".diWeightMarker").value="0",r.querySelector(".diWeightMarker").disabled=!1,r.querySelector(".diWeight").value="0",r.querySelector(".diWeight").disabled=!0)};Array.from(t.querySelectorAll(".dryIce")).forEach(e=>{e.removeEventListener("change",n),e.addEventListener("change",n)});let i=r=>{Array.from(t.querySelectorAll(".rtMarker")).forEach(e=>{"6"===r.target.value||"7"===r.target.value?e.style.display="inline":(e.style.display="none",e.checked=!1)}),t.querySelector("input[name='d2TimeStamp']")&&(t.querySelector("input[name='d2TimeStamp']").disabled="6"!==r.target.value&&"7"!==r.target.value),"7"===r.target.value?(t.querySelector(".dedicatedNote").style.display="block",Array.from(t.querySelectorAll("input[id^='pSigReq'], input[id^='dSigReq']")).forEach(t=>{t.checked=!0,e.triggerEvent(t,"change")})):t.querySelector(".dedicatedNote").style.display="none"};Array.from(t.querySelectorAll(".charge")).forEach(e=>{e.removeEventListener("change",i),e.addEventListener("change",i)}),Array.from(t.querySelectorAll("input[type='number']")).forEach(e=>{e.addEventListener("keydown",()=>{"0"===e.value&&(e.value="")})}),Array.from(t.querySelectorAll("input[type='checkbox'][name='pSigReq'], input[type='checkbox'][name='dSigReq']")).forEach(e=>{e.addEventListener("click",e=>{"7"===t.querySelector(".charge").value&&e.preventDefault()})}),Array.from(t.querySelectorAll("input[type='checkbox'][name='pSigReq'], input[type='checkbox'][name='dSigReq'], input[type='checkbox'][name='d2SigReq']")).forEach(e=>{e.addEventListener("change",()=>{let e=t.querySelector("input[type='checkbox'][name='pSigReq']").checked,r=t.querySelector("input[type='checkbox'][name='dSigReq']").checked,l=t.querySelector("input[type='checkbox'][name='d2SigReq']").checked,n=t.querySelector(".sigNote");e||r||l?n.classList.remove("hide"):!n.classList.contains("hide")&&n.classList.add("hide")})}),Array.from(t.querySelectorAll("input[list]")).forEach(t=>{t.addEventListener("change",t=>{if(e.isTarget(t.target)){let r=[];if(Array.from(document.querySelectorAll("datalist#"+t.target.getAttribute("list")+" option")).forEach(e=>{let t=parser.parseFromString(e.innerHTML,"text/html");t.innerHTML=e.innerHTML,r.push(t.documentElement.textContent)}),""!==t.target.value&&-1===r.indexOf(t.target.value)){let r=t.target.getAttribute("placeholder")||"";return t.target.value="",t.target.classList.add("elementError"),t.target.placeholder="Selection Not On File",e.triggerEvent(t.target,"change"),void setTimeout(()=>{t.target.classList.remove("elementError"),t.target.placeholder=r},3e3)}t.target.classList.contains("members")&&(ci.getClosest(t.target,"#information").querySelector("[name=repeatClient]").value=-1==t.target.value.slice(t.target.value.indexOf(";")).indexOf("t")?1:0)}t.target.title=t.target.value}),"Address1"===t.getAttribute("name").slice(1)&&t.addEventListener("blur",t=>{let r;Array.from(document.querySelectorAll("#addy1 option")).forEach(e=>{e.value===t.target.value&&(r=e.getAttribute("data-value"))}),"undefined"==typeof r||Array.from(document.querySelectorAll("#addy2 option")).forEach(l=>{l.getAttribute("data-value")===r&&(e.getClosest(t.target,"fieldset").querySelector("input[name='"+t.target.getAttribute("name").slice(0,-1)+"2']").value=l.value)})})}),Array.from(t.querySelectorAll("#toMe, #fromMe")).forEach(t=>{let r="deliveryField"===e.getClosest(t,"fieldset").getAttribute("id")?document.querySelector("#pickupField"):document.querySelector("#deliveryField"),l=e.getClosest(t,"fieldset");t.addEventListener("click",e=>{let t="",l=document.querySelector("input[name='ClientName'][form='javascriptVars']").value+document.querySelector("input[name='Department'][form='javascriptVars']").value+document.querySelector("input[name='ShippingAddress1'][form='javascriptVars']").value+document.querySelector("input[name='ShippingAddress2'][form='javascriptVars']").value;Array.from(r.querySelectorAll(".clientList")).forEach(e=>{t+=e.value}),t===l&&e.preventDefault()}),t.addEventListener("change",t=>{t.target.checked?(e.getClosest(t.target,"thead").querySelector(".onFile").checked=!1,e.triggerEvent(e.getClosest(t.target,"thead").querySelector(".onFile"),"change"),Array.from(e.getClosest(t.target,"fieldset").querySelectorAll(".clientList")).forEach(e=>{e.disabled=!1,e.required=!1,e.readOnly=!0,e.style.display="inline"}),Array.from(e.getClosest(t.target,"fieldset").querySelectorAll(".clientSelect")).forEach(e=>{e.disabled=!0,e.style.display="none"}),r.querySelector(".me").disabled=!0,l.querySelector("[id$='Client']").value=document.querySelector("input[name='ClientName'][form='javascriptVars']").value,l.querySelector("[id$='Department']").value=document.querySelector("input[name='Department'][form='javascriptVars']").value,l.querySelector("[id$='Address1']").value=document.querySelector("input[name='ShippingAddress1'][form='javascriptVars']").value,l.querySelector("[id$='Address2']").value=document.querySelector("input[name='ShippingAddress2'][form='javascriptVars']").value):(Array.from(l.querySelectorAll(".clientList")).forEach(e=>{e.readOnly=!1}),Array.from(l.querySelectorAll("[id$='Client'], [id$='Department'], [id$='Address1'], [id$='Address2']")).forEach(e=>{e.value=""}),r.querySelector(".me").disabled=!1)})}),Array.from(document.querySelectorAll(".onFile")).forEach(t=>{t.addEventListener("change",t=>{t.target.checked?(e.getClosest(t.target,"thead").querySelector(".me").checked=!1,e.triggerEvent(e.getClosest(t.target,"thead").querySelector(".me"),"change"),Array.from(e.getClosest(t.target,"fieldset").querySelectorAll(".clientList")).forEach(e=>{e.disabled=!0,e.required=!1,e.readOnly=!1,e.style.display="none"}),Array.from(e.getClosest(t.target,"fieldset").querySelectorAll(".clientSelect")).forEach(e=>{e.disabled=!1,e.style.display="inline"}),"onFileP"===t.target.id?document.querySelector("#toMe").disabled=!1:document.querySelector("#fromMe").disabled=!1):(Array.from(e.getClosest(t.target,"fieldset").querySelectorAll(".clientList")).forEach(e=>{e.disabled=!1,e.required="Department"!==e.getAttribute("name").slice(1),e.style.display="inline"}),Array.from(e.getClosest(t.target,"fieldset").querySelectorAll(".clientSelect")).forEach(e=>{e.disabled=!0,e.style.display="none"}))})}),Array.from(document.querySelectorAll(".clientSelect")).forEach(t=>{t.addEventListener("change",t=>{let r=t.target.options[t.target.selectedIndex].getAttribute("data-value");Array.from(e.getClosest(t.target,"fieldset").querySelectorAll(".clientSelect")).forEach(e=>{Array.from(e.options).forEach(e=>{e.selected=e.getAttribute("data-value")===r})})})}),t.querySelector(".receivedReady").addEventListener("change",r=>{Array.from(t.querySelectorAll(".readyNote, .readyDate")).forEach(t=>{t.style.display="none"===t.style.display?"inline-block":"none",t.classList.contains("readyDate")&&(!0===r.target.checked&&(t.value=""),e.triggerEvent(t,"change"),t.required=!r.target.checked)})});let a=r=>{if(!/(deliveryRequest\d+)/.test(e.getClosest(r.target,"div").id)){let e=new Date,l=new Date(r.target.value);if(e>=l){let e=make(["p",{class:"center readyError"},"Ready Time should be either \"Now\" or a time in the future."]);t.querySelector(".readyError")||t.querySelector(".ticketError").appendChild(e)}else if(t.querySelector(".readyError")){let e=t.querySelector(".readyError");e.parentNode.removeChild(e)}t.querySelector(".submitForm").disabled=null!==t.querySelector(".readyError")}};t.querySelector(".readyDate").removeEventListener("change",a),t.querySelector(".readyDate").addEventListener("change",a),t.querySelector(".cancelTicketEditor")&&t.querySelector(".cancelTicketEditor").addEventListener("click",()=>{if(t.removeChild(t.querySelector(".removableByEditor")),0===document.querySelectorAll(".cancelTicketEditor").length)for(;t.parentNode.querySelector("datalist");)t.parentNode.removeChild(t.parentNode.querySelector("datalist"));Array.from(t.querySelectorAll("table.hide, hr.hide, button.hide")).forEach(e=>{e.classList.remove("hide")})});let o=async r=>{r.preventDefault(),r.target.disabled=!0,t.querySelector(".cancelTicketEditor")&&(t.querySelector(".cancelTicketEditor").disabled=!0);let l=1,n=make(["span",{class:"ellipsis"},"."]);t.querySelector(".diWeight")&&(l=t.querySelector(".diWeight").getAttribute("step")),t.querySelector(".ticketError").innerHTML="",t.querySelector(".ticketError").appendChild(n);let i=!0,a=setInterval(()=>{!0===i&&(n.innerHTML+="..",i=15>n.innerHTML.length&&1!=n.innerHTML.length),!1===i&&(n.innerHTML=n.innerHTML.slice(2),i=1===n.innerHTML.length)},500),o=!1,s="deliveryRequest"===t.querySelector(".removableByEditor").getAttribute("id")?"":t.querySelector(".removableByEditor").getAttribute("id").match(/\d+/)[0],c=["pClient","pAddress1","pAddress2","pCountry","dClient","dAddress1","dAddress2","dCountry","dispatchedTo","billTo"],u={};return(""===s||"0"===document.querySelector("#request"+s+" input[name='contract']").value)&&c.push("requestedBy"),Array.from(t.querySelectorAll("input[form='request"+s+"'], select[form='request"+s+"'], textarea[form='request"+s+"']")).forEach(r=>{if(r.name)if("checkbox"!==r.type&&!1===r.disabled){if(-1!==c.indexOf(r.getAttribute("name"))&&""===r.value?(o=!0,r.classList.add("elementError"),setTimeout(()=>{r.classList.remove("elementError")},3e3)):r.classList.remove("elementError"),"deliveryRequest"===e.getClosest(r,"div").id&&"readyDate"===r.getAttribute("name")&&"none"!==r.style.display){let e=make(["p",{class:"center readyError"},"Ready Time should be either \"Now\" or a time in the future."]),l=new Date,n=new Date(r.value);(l>=n||""===r.value)&&(o=!0,!t.querySelector(".readyError")&&t.querySelector(".ticketError").parentNode.appendChild(e),r.classList.add("elementError"),setTimeout(()=>{r.classList.remove("elementError"),t.querySelector(".readyError")&&e.parentNode.removeChild(e)},3e3))}if(/(deliveryRequest\d+)/.test(e.getClosest(r,"div").id)){let e=make(["p",{class:"center timingError"},"Timing Error"]);switch(r.getAttribute("name")){case"readyDate":"none"!==r.style.display&&(""===r.value&&(o=!0,!t.querySelector(".timingError")&&t.querySelector(".ticketError").parentNode.appendChild(e),r.classList.add("elementError"),setTimeout(()=>{r.classList.remove("elementError"),t.querySelector(".timingError")&&e.parentNode.removeChild(e)},3e3)),""!==t.querySelector(".pTimeStamp").value&&t.querySelector(".pTimeStamp").value<r.value&&(o=!0,!t.querySelector(".timingError")&&t.querySelector(".ticketError").parentNode.appendChild(e),t.querySelector(".pTimeStamp").classList.add("elementError"),setTimeout(()=>{t.querySelector(".pTimeStamp").classList.remove("elementError"),t.querySelector(".timingError")&&e.parentNode.removeChild(e)},3e3)),""!==t.querySelector(".dTimeStamp").value&&t.querySelector(".dTimeStamp").value<r.value&&(o=!0,!t.querySelector(".timingError")&&t.querySelector(".ticketError").parentNode.appendChild(e),t.querySelector(".dTimeStamp").classList.add("elementError"),setTimeout(()=>{t.querySelector(".dTimeStamp").classList.remove("elementError"),t.querySelector(".timingError")&&e.parentNode.removeChild(e)},3e3)),""!==t.querySelector(".d2TimeStamp").value&&t.querySelector(".d2TimeStamp").value<r.value&&(o=!0,!t.querySelector(".timingError")&&t.querySelector(".ticketError").parentNode.appendChild(e),t.querySelector(".d2TimeStamp").classList.add("elementError"),setTimeout(()=>{t.querySelector(".d2TimeStamp").classList.remove("elementError"),t.querySelector(".timingError")&&e.parentNode.removeChild(e)},3e3)));break;case"d2TimeStamp":""!==r.value&&(""===t.querySelector(".dTimeStamp").value||t.querySelector(".dTimeStamp").value>r.value||""===t.querySelector(".pTimeStamp").value||t.querySelector(".pTimeStamp").value>r.value||""===t.querySelector(".dispatchTimeStamp").value||t.querySelector(".dispatchTimeStamp").value>r.value)&&(o=!0,!t.querySelector(".timingError")&&t.querySelector(".ticketError").parentNode.appendChild(e),r.classList.add("elementError"),setTimeout(()=>{r.classList.remove("elementError"),t.querySelector(".timingError")&&e.parentNode.removeChild(e)},3e3));break;case"dTimeStamp":""!==r.value&&(""===t.querySelector(".pTimeStamp").value||t.querySelector(".pTimeStamp").value>r.value||""===t.querySelector(".dispatchTimeStamp").value||t.querySelector(".dispatchTimeStamp").value>r.value)&&(o=!0,!t.querySelector(".timingError")&&t.querySelector(".ticketError").parentNode.appendChild(e),r.classList.add("elementError"),setTimeout(()=>{r.classList.remove("elementError"),t.querySelector(".timingError")&&e.parentNode.removeChild(e)},3e3));break;case"pTimeStamp":""!==r.value&&(console.log(t.querySelector(".dispatchTimeStamp").value,r.value,t.querySelector(".dispatchTimeStamp").value>r.value),(""===t.querySelector(".dispatchTimeStamp").value||t.querySelector(".dispatchTimeStamp").value>r.value)&&(o=!0,!t.querySelector(".timingError")&&t.querySelector(".ticketError").parentNode.appendChild(e),r.classList.add("elementError"),setTimeout(()=>{r.classList.remove("elementError"),t.querySelector(".timingError")&&e.parentNode.removeChild(e)},3e3)));break;case"dispatchTimeStamp":""===r.value&&(o=!0,!t.querySelector(".timingError")&&t.querySelector(".ticketError").parentNode.appendChild(e),r.classList.add("elementError"),setTimeout(()=>{r.classList.remove("elementError"),t.querySelector(".timingError")&&e.parentNode.removeChild(e)},3e3));}}u[r.getAttribute("name")]=r.value}else"checkbox"===r.type&&(u[r.getAttribute("name")]="repeatClient"===r.getAttribute("name")?1-r.checked:0+r.checked)}),u.formKey=document.querySelector("#formKey").value,u.mapAvailable=e.getClosest(t,".page").querySelector(".mapContainer")?1:0,1===u.dryIce&&(0!=u.diWeight%l||0==u.diWeight)&&(t.querySelector(".ticketError").innerHTML=`Dry Ice in increments of ${l} only.`,t.querySelector(".diWeight").classList.add("elementError"),o=!0,setTimeout(()=>{t.querySelector(".ticketError").innerHTML="",t.querySelector(".diWeight").classList.remove("elementError")},3500)),!0===o?(clearInterval(a),n.remove(),Array.from(t.querySelectorAll(".submitForm, .cancelTicketEditor")).forEach(e=>{e.disabled=!1}),!1):void(await e.fetch_template({url:"./enterTicket.php",postData:u,headers:{"Content-Type":"application/x-www-form-urlencoded","Content-Length":JSON.stringify(u).length}}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(`${e.status} ${e.statusText}`)}).then(r=>{if(clearInterval(a),n.remove(),-1!==r.indexOf("Session Error"))return e.showLogin();if(-1!==r.indexOf("data-value=\"error\""))throw new Error(r);else{let l=parser.parseFromString(r,"text/html"),n=l.querySelector("#deliveryConfirmation")||l.querySelector(".editorConfirmation");if(t.querySelector(".removableByEditor").innerHTML="",t.querySelector(".removableByEditor").appendChild(n),u.mapAvailable){scroll(0,0);let t={};Array.from(document.querySelectorAll("input[form='coordinates']")).forEach(e=>{t[e.getAttribute("name")]=e.value}),t.mapDivID="map",e.updateMap(t)}assignConfirmationListeners(t)}}).then(e.refreshFormKey).catch(e=>{console.error(e.message),clearInterval(a),n.remove(),t.querySelector(".ticketError").appendChild(displayErrorMessage(e)),setTimeout(()=>{t.querySelector(".ticketError").innerHTML=""},3500),Array.from(t.querySelectorAll(".submitForm, .cancelTicketEditor")).forEach(e=>{e.disabled=!1})}))};t.querySelector(".submitForm").removeEventListener("click",o),t.querySelector(".submitForm").addEventListener("click",o)},assignConfirmationListeners=t=>{Array.from(t.querySelectorAll(".confirmed, .editForm")).forEach(r=>{r.addEventListener("click",async r=>{r.preventDefault(),Array.from(t.querySelectorAll("button")).forEach(e=>e.setAttribute("disabled",!0));let l=r.target.getAttribute("form"),n={},i=make(["span",{class:"ellipsis"},"."]);t.querySelector(".ticketError").appendChild(i);let a=!0,o=setInterval(()=>{!0===a&&(i.innerHTML+="..",a=15>i.innerHTML.length&&1!=i.innerHTML.length),!1===a&&(i.innerHTML=i.innerHTML.slice(2),a=1===i.innerHTML.length)},500);n.formKey=document.querySelector("#formKey").value,n.ticketEditor=1,Array.from(t.querySelectorAll("input[form='"+r.target.getAttribute("form")+"']")).forEach(e=>{n[e.getAttribute("name")]=e.value}),r.target.classList.contains("confirmed")&&/\d/.test(r.target.getAttribute("form"))&&(n.updateTicket=1),r.target.classList.contains("editForm")&&!/\d/.test(r.target.getAttribute("form"))&&(n.ticketEditor=0),await e.fetch_template({url:"./enterTicket.php",postData:n,headers:{"Content-Type":"application/x-www-form-urlencoded","Content-Length":JSON.stringify(n).length}}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(`${e.status} ${e.statusText}`)}).then(l=>{if(-1!==l.indexOf("Session Error"))return i.remove(),clearTimeout(o),Array.from(t.querySelectorAll("button")).forEach(e=>e.removeAttribute("disabled")),e.showLogin();if(-1!==l.indexOf("data-value=\"error\""))throw new Error(l);if(r.target.classList.contains("editForm")){Array.from(t.querySelectorAll("datalist, .removableByEditor")).forEach(e=>{e.parentNode.removeChild(e)});let n=parser.parseFromString(l,"text/html"),i=document.createDocumentFragment(),a=document.querySelector(".subContainer");Array.from(n.querySelectorAll("datalist, div")).forEach(e=>{i.appendChild(e)}),t.appendChild(i),/\d/.test(r.target.getAttribute("form"))||(t.appendChild(a),e.updateMap({mapDivID:"map"})),assignTicketFormListeners()}else if(r.target.classList.contains("confirmed")){if("remove"===l){let e=make(["p",{class:"center"},"Update Successful"]);return t.appendChild(e),scrollTo(0,document.querySelector("header").offsetHeight+5),void setTimeout(()=>{document.remove(t)},3e3)}if(!e.getClosest(t,".page").querySelector(".mapContainer")){let t=document.querySelector("#ticketEditorResultContainer"),n=e.getClosest(r.target,".sortable"),i=parser.parseFromString(l,"text/html"),a=document.createDocumentFragment(),o=make(["p",{class:"center"},"Update Successful"]);n.appendChild(o),a.appendChild(i.querySelector(".sortable")),setTimeout(()=>{t.insertBefore(a,n),t.removeChild(n),assignTicketEditorListener()},3500)}else{let t=parser.parseFromString(l,"text/html");clearElement(document.querySelector("#deliveryConfirmation")),document.querySelector("#deliveryConfirmation").appendChild(t.querySelector("#deliveryRequestComplete")),setTimeout(e.refreshTicketEntry,3500)}}}).then(e.refreshFormKey).catch(e=>{console.error(e.message),clearTimeout(o),i.remove(),t.querySelector(".ticketError").appendChild(displayErrorMessage(e)),setTimeout(()=>{t.querySelector(".ticketError").innerHTML=""},3500),Array.from(t.querySelectorAll("button")).forEach(e=>e.removeAttribute("disabled"))})})})},document.addEventListener("rjdci_resolutionchange",function(){setTimeout(()=>{e.fixDeadRunButton(),e.centerForm(document.querySelector("#confirmLogin"))},500)}),document.addEventListener("rjdci_loggedout",function(){setTimeout(e.disableApp,500)}),document.addEventListener("rjdci_loggedin",function(){setTimeout(e.enableApp,500)}),document.addEventListener("DOMContentLoaded",()=>{let t=screen.width,r=screen.height;setInterval(()=>{(screen.width!==t||screen.height!==r)&&(t=screen.width,r=screen.height,e.resolutionchange&&document.dispatchEvent(e.resolutionchange))},250),e.assignLinkValues();const l=document.querySelector("header"),n=document.querySelector(".menu__header");updateNetworkStatus=()=>{navigator.onLine?(l.classList.remove("app__offline"),n.style.background="#1E88E5"):(e.toast("You are now offline.."),l.classList.add("app__offline"),n.style.background="#9E9E9E")},navigator.onLine||updateNetworkStatus(),window.addEventListener("online",updateNetworkStatus,!1),window.addEventListener("offline",updateNetworkStatus,!1);let i=document.querySelector(".header__icon"),a=document.querySelector(".menu"),o=document.querySelector(".menu__overlay"),s=document.querySelector(".fab__push");showMenu=()=>{let e=document.querySelector("#signature-pad");if(null!==e)return!1;if(document.querySelector("header").classList.contains("loggedout"))return!1;let t=document.querySelector("#newUpdate");null===t||t.classList.contains("hide")||t.classList.add("hide"),a.style.transform="translateX(0)",a.classList.add("menu--show"),o.classList.add("menu__overlay--show")},hideMenu=()=>{a.style.transform="translateX(-110%)",a.classList.remove("menu--show"),o.classList.remove("menu__overlay--show")},i.addEventListener("click",showMenu,!1),o.addEventListener("click",hideMenu,!1),Array.from(document.querySelectorAll(".menu__list li")).forEach(e=>{e.addEventListener("click",hideMenu,!1)}),null!==s&&s.addEventListener("click",hideMenu,!1),document.querySelector("#logoutLink button").addEventListener("click",t=>{t.preventDefault(),e.logout()}),document.querySelector("#confirmLogin")&&e.populatePage().then(()=>{e.assignListeners(),e.assignQueriedTicketListeners(),document.dispatchEvent(e.loaded)}),Array.from(document.querySelectorAll(".menu__list li")).forEach(t=>{t.addEventListener("click",()=>{t.querySelector("a")&&e.Swipe.slide(t.querySelector("a").getAttribute("data-value"),300)})}),document.querySelector(".header__icon").addEventListener("click",()=>{let e=document.querySelector("#sig"),t=document.querySelector("#confirmLogin");if(null!==e||0<t.offsetWidth&&0<t.offsetHeight)return!1}),document.querySelector(".refresh").addEventListener("click",()=>{location.reload()}),document.querySelector("#confirm").addEventListener("click",async t=>{t.preventDefault();let r=!1;if(Array.from(document.querySelectorAll("#login input")).forEach(e=>{"function"!==e.id&&""===e.value&&(r=!0,e.classList.add("elementError"),setTimeout(()=>{e.classList.remove("elementError")},3e3))}),!0==r)return!1;let l=make(["span",{class:"ellipsis"},"."]),n=!0,i=setInterval(()=>{!0===n&&(l.innerHTML+="..",n=15>l.innerHTML.length&&1!=l.innerHTML.length),!1===n&&(l.innerHTML=l.innerHTML.slice(2),n=1===l.innerHTML.length)},500),a={};document.querySelector("#confirmMessage").appendChild(l),a.clientID=document.querySelector("#uid").value,a.upw=document.querySelector("#upw").value,a.mobile=document.querySelector("#mobile").value,a.noSession=1,await e.refreshFormKey().then(async()=>await e.fetch_template({url:"../login.php",postData:a,headers:{"Content-Type":"application/x-www-form-urlencoded","Content-Length":JSON.stringify(a).length}})).then(e=>{if("undefined"==typeof e)throw new Error(e.status+" "+e.statusText);if(e.ok)return e.text();throw new Error(e.status+" "+e.statusText)}).then(t=>{if(clearInterval(i),-1!==t.indexOf("Session Error"))throw new Error("Session Error");if(-1===t.indexOf("error")&&-1===t.indexOf("Invalid Credentials"))document.querySelector("#confirmMessage").innerHTML="User Confirmed",setTimeout(()=>{if(clearElement(document.querySelector("#confirmMessage")),document.querySelector("#confirmLogin").classList.add("hide"),""!==document.querySelector("#function").value){let t=document.querySelector("#function").value;document.querySelector("#function").value="",console.log(t),e[`${t}`]()}document.dispatchEvent(e.loggedin)},1e3);else throw new Error(t)}).catch(e=>{clearInterval(i),document.querySelector("#confirmMessage").innerHTML="<span class=\"error\">Error</span>: "+e.message,setTimeout(()=>{clearElement(document.querySelector("#confirmMessage"))},4e3)})}),document.querySelector("#cancel").addEventListener("click",()=>{window.location.assign("./logout")})})})(window.rjdci=window.rjdci||{});